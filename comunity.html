<link href="https://cdn.jsdelivr.net/npm/beercss@3.9.6/dist/cdn/beer.min.css" rel="stylesheet" /><link href="https://cdn.jsdelivr.net/npm/beercss@3.9.6/dist/cdn/beer.min.css" rel="stylesheet" />
<script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.9.6/dist/cdn/beer.min.js"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css"></link>
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
<script src="https://www.modelsofidentity.com/colosal/js/smoothscroll.js"></script>

<style>
  article{
  background-color: #f5f6f6 !important;
    color: black !important;
}
input{
  background-color: white !important;
}

dialog{
  background-color: #f5f6f6 !important;
}



  @media (min-width: 500px) {  
    .youtubeframe{
      height: 320px !important;
    }
}

 .youtubeframe{
      border-radius: 10px !important;
      height: 200px ;
      max-width: 500px;

    }


  .showbox {
  display: flex;
    justify-content: center;
    align-items: center;
    height: 60vh;
}

.loader {
  position: relative;
  margin: 0px auto;
  width: 100px;
}
.loader:before {
  content: "";
  display: block;
  padding-top: 100%;
}

.circular {
  -webkit-animation: rotate 2s linear infinite;
          animation: rotate 2s linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}

.path {
  stroke-dasharray: 1, 200;
  stroke-dashoffset: 0;
  -webkit-animation: dash 1.5s ease-in-out infinite, color 6s ease-in-out infinite;
          animation: dash 1.5s ease-in-out infinite, color 6s ease-in-out infinite;
  stroke-linecap: round;
}

@-webkit-keyframes rotate {
  100% {
    transform: rotate(360deg);
  }
}

@keyframes rotate {
  100% {
    transform: rotate(360deg);
  }
}
@-webkit-keyframes dash {
  0% {
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -124px;
  }
}
@keyframes dash {
  0% {
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 89, 200;
    stroke-dashoffset: -124px;
  }
}
@-webkit-keyframes color {
  100%, 0% {
    stroke: #d62d20;
  }
  40% {
    stroke: #0057e7;
  }
  66% {
    stroke: #008744;
  }
  80%, 90% {
    stroke: #ffa700;
  }
}
@keyframes color {
  100%, 0% {
    stroke: #d62d20;
  }
  40% {
    stroke: #0057e7;
  }
  66% {
    stroke: #008744;
  }
  80%, 90% {
    stroke: #ffa700;
  }
}
  
  @media (max-width: 600px){
    .hidemobile{
      display: none !important;
    }
  }

  .input-group {
  display: flex;
  align-items: center; /* Centra verticalmente los elementos */
  gap: 10px; /* Espacio entre imagen e input */
}

 .form-control {
  flex: 1; /* Input ocupa todo el espacio disponible */
  border: none; /* Sin borde */
  border-radius: 20px; /* Bordes redondeados */
  padding: 10px 15px; /* Espaciado interno */
  font-size: 16px; /* Tamaño de la fuente */
  outline: none; /* Sin contorno */
  box-shadow: none; /* Sin sombra */
}
.infoProf {
  border-radius: 16px;
  position: absolute;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  font-size: 13px;
  width: 200px;
  background: white;
  z-index: 100;
}
.liked {
    color: red;
}
</style>

<body style="background-color: white;" ng-app="postApp" ng-controller="postController">

  <main class="responsive">
    <div class="grid">
      <section class="s12 m8 l8" ng-if="!selectedPostForComments">
        <article class="no-elevate large-round">
          <div class="row"><img class="circle small" src="https://lh3.googleusercontent.com/d/1h0PAuatp8mguH19cso6wh19mjMVa0K5V"/>
            <div class="max">
              <div class="field fill round">
                <input placeholder="Create Post" onclick="ui('#dialog-post')"/>
              </div>
            </div>
            <button class="transparent circle" onclick="ui('#dialog-post')"><i>image</i>
              <div class="tooltip bottom">Create Media Post</div>
            </button>
            <button class="transparent circle" onclick="ui('#dialog-post')"><i>link</i>
              <div class="tooltip bottom">Create Link Post</div>
            </button>
          </div>
        </article>
      <nav  style="justify-content: center; flex-wrap: wrap; ">
          <button class="chip" ng-click="filterPosts('youtube')"><i>local_fire_department</i><span>Trending</span></button>
                    <button class="chip"><i>arrow_circle_up</i><span>Top</span></button>
          <button class="chip"><i>news</i><span>New</span></button>

        </nav>
        
          <div class="showbox" ng-if="userDataLoaded">
      <div class="loader">
        <svg class="circular" viewbox="25 25 50 50">
          <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"></circle>
        </svg>
      </div>
    </div> 
        
         <article class="no-elevate round" ng-repeat="post in filteredData.slice(0, itemsPerPage)">
          <div class="row top-align" >
            <div class="max" >
              
              
             
                
                 <div class="row" ng-click="toggleProfileInfo(post.id); $event.preventDefault()"> <img class="circle small" ng-src="{{post.photo}}"/>  
            <div><b>   <label style="font-size: 14px;"><a href="#" >{{post.user}}</a></label></b>
              <div>   <label class="grey-text">Nivel 1  ● hace {{calculateTimeAgo(post.date)}}</label></div>

              <div class="infoProf "
         style="margin-top: 5px; padding: 8px;"
         ng-if="showProfileInfo[post.id]">
      <i class="ri-user-line"></i> {{post.user}}<br>
      <small>Email: {{post.email}}</small><br>
      <small>Plan: {{post.plan}}</small>
    </div>
            </div>
          </div>
                
   
                
                <div class="row">
                  <div class="max">
                    <h6 class="no-margin">{{post.id}}</h6>
                 
                  </div>
                </div>  
                <div class="medium-space"></div>
                
                 <div style="display: flex; justify-content: center;">
                    <iframe width="100%" height="{{post.height}}" ng-src="{{trustAsResourceUrl(post.url)}}" frameborder="0" ng-class="{'youtubeframe': post.type == 'youtube'}"></iframe>
                   </div>

                <div ng-if="post.type == 'text'" >{{post.url}}
              </div>
                <a  ng-if="post.type == 'link'" class="row link" href="{{post.url}}" target="_blank"><span>{{post.url}}</span><i>link</i></a>
                
                <a ng-if="post.type == 'img'" href="{{post.url}}" target="_blank"><img class="responsive" style="border-radius: 10px;" ng-src="{{post.url}}"/></a>
                
                
                
           

                <div class="row" style="display: flex; justify-content: space-between;">
                  <div>
                  <button class="transparent circle" ng-click="newLike($index, post)">
    <i ng-if="post.likes.includes(user)" class="ri-heart-fill liked"></i>
    <i ng-if="!post.likes.includes(user)" class="ri-heart-line"></i>
    {{post.likes.length}}
</button>
           <button class="transparent circle" ng-click="openComments(post); " ><i>chat_bubble</i>{{post.comments.length}}</button>
         </div>

<button class="chip" ><i>share</i><span>Share</span></button>
             </div>
              
              
              
          </div>
            
        </article>
        
        

  <nav style="justify-content: center; flex-wrap: wrap; ">
  <button class="chip" ng-click="loadMorePosts()" ng-if="itemsPerPage < filteredData.length">
    Cargar más posts
  </button>
    <br><br>
</nav>
      </section>


    <div ng-if="selectedPostForComments"  class="s12 m12 l8">
  <div class="row ">
    <button class="chip" ng-click="backToFeed()">
      ← Volver
    </button>
  </div>

  <article class="no-elevate round" >
          <div class="row top-align">
            <div class="max" >
              <div >
                 <div class="row"> <img class="circle small" ng-src="{{selectedPostForComments.photo}}"/>  
            <div><b>   <label style="font-size: 14px;"><a href="#" >{{selectedPostForComments.user}}</a></label></b>
              <div>   <label class="grey-text">Nivel 1  ● hace {{calculateTimeAgo(selectedPostForComments.date)}}</label></div>
            </div>
          </div>
                <div class="row">
                  <div class="max">
                    <h6 class="no-margin">{{selectedPostForComments.id}}</h6>
                  </div>
                </div>  
                <div class="medium-space"></div>
                
                <div ng-if="selectedPostForComments.type == 'text'" >{{selectedPostForComments.url}}
              </div>
                <a  ng-if="selectedPostForComments.type == 'link'" class="row link" href="{{post.url}}" target="_blank"><span>{{selectedPostForComments.url}}</span><i>link</i></a>
                <a ng-if="selectedPostForComments.type == 'img'" href="{{post.url}}" target="_blank"><img class="responsive" style="border-radius: 10px;" ng-src="{{selectedPostForComments.url}}"/></a>
                <iframe width="100%" height="{{selectedPostForComments.height}}" ng-src="{{trustAsResourceUrl(selectedPostForComments.url)}}" frameborder="0" ng-class="{'youtubeframe': selectedPostForComments.type == 'youtube'}"></iframe>
            </div> 
          </div>  
        </article>
  <section class="p">

     <div class="input-group">
    <img 
      src="https://lh3.googleusercontent.com/d/1h0PAuatp8mguH19cso6wh19mjMVa0K5V" 
      style="width: 40px; height: 40px; border-radius: 50%;"
    >
    <input 
      type="text" 
      class="form-control" 
      placeholder="Escribe tu respuesta" 
     id="form-control"
      ng-model="newText"
    >
        <button class="responsive" style="width: 60px !important;">Responder</button>
  </div>
    <br>
   
    <div ng-if="selectedPostForComments.comments.length > 0" ng-repeat="comment in selectedPostForComments.comments">
     <div class="row"><img class="circle small" src="https://lh3.googleusercontent.com/d/1h0PAuatp8mguH19cso6wh19mjMVa0K5V"/>
            <div><b>{{comment.user}}</b>
              <div> {{comment.comment}}</div>
            </div>
          </div>
       <hr style="color: #E5E4E2; opacity: 0.5; margin-top: 5px; margin-bottom: 5px;">
    </div>
    <div class="card p mb" ng-if=" selectedPostForComments.comments.length === 0">
     Aún no hay comentarios.
    </div>
  </section>
</div>

      
      <section class="s12 m4 l4 hidemobile" >
        <article class="no-elevate round">
          <div class="row"><i>trophy</i>
            <div><b>Mozart Premium</b>
           
            </div>
          </div>
             <div>The best Mozart Academy experience</div>
          <nav>
            <button class="responsive">Try Now</button>
          </nav>
        </article>
        <article class="no-elevate round">
          <h6>Home</h6>
          <p>Your personal frontpage. Come here to check in with your favorite communities.</p>
          <div class="medium-divider"></div>
          <nav class="vertical">
            <button class="responsive">Crear Post</button>
            <button class="responsive border">Create Community</button>
          </nav>
        </article>
        <article class="no-elevate round">
          <h6>Recent Posts</h6>
          <nav class="drawer max no-padding"><a class="small-round"><img class="small" src="https://styles.redditmedia.com/t5_3htkz/styles/communityIcon_5gn47dhdp4o31.png"/>
              <div class="max wrap">
                <div>How do I disabled all A11y messages? They are annoying</div>
                <label class="grey-text">5 points - 15 comments - 3h</label>
              </div></a><a class="small-round"><img class="small" src="https://styles.redditmedia.com/t5_3htkz/styles/communityIcon_5gn47dhdp4o31.png"/>
              <div class="max wrap">
                <div>"The golden rule of assertions"</div>
                <label class="grey-text">4 points - 10 comments - 3h</label>
              </div></a><a class="small-round"><img class="small" src="https://styles.redditmedia.com/t5_3htkz/styles/communityIcon_5gn47dhdp4o31.png"/>
              <div class="max wrap">
                <div>Cheers to Craft Design: Beer CSS - A Lightweight Material Design Framework</div>
                <label class="grey-text">3 points - 4 comments - 3h</label>
              </div></a></nav>
        </article>
      </section>
    </div>
    <dialog id="dialog-post">
      <nav class="wrap">
        <h6>Create a post</h6>
      
      </nav>
      <div class="space"></div>
      <div class="medium-height large-width">
        <div class="tabs scroll left-align m l"><a class="active" data-ui="#post"><i>news</i><span>Post</span></a><a data-ui="#image-video"><i>image</i><span>Image &amp; Video</span></a><a data-ui="#link"><i>link</i><span>Link</span></a><a class="grey-text"><i>insert_chart</i><span>Pool</span></a></div>
        <div class="space"></div>
        <div class="page bottom active" id="post">
         
          <div class="field border label">
            <input/>
            <label>Title</label>
          </div>
          <div class="field border label extra textarea">
            <textarea ng-model="newText"></textarea>
            <label>Text (optional)</label>
          </div>
        </div>
        <div class="page bottom" id="image-video">
        
          <div class="row">
            <div class="max">
              <div class="field border label">
                <input/>
                <label>Title</label>
              </div>
            </div>
            <button><span>Select a file</span>
              <input type="file"/>
            </button>
          </div>
        </div>
        <div class="page bottom" id="link">
      
          <div class="field border label">
            <input/>
            <label>Title</label>
          </div>
          <div class="field border label">
            <textarea></textarea>
            <label>Url</label>
          </div>
        </div>
        <div class="page bottom" id="pool"></div>
      </div>
      <footer class="fixed">
        <nav class="right-align">
          <button class="border" data-ui="#dialog-post">Cancel</button>
          <button data-ui="#dialog-post" ng-click="newPost(newText)">Confirm</button>
        </nav>
      </footer>
    </dialog>
  </main>
</body>



<script>

 
var app = angular.module('postApp', [])
 app.controller('postController', ['$scope', '$http', '$interval', '$sce', '$timeout', function($scope, $http, $interval, $sce, $timeout) {
    $scope.trustAsResourceUrl = function(url) {
        return $sce.trustAsResourceUrl(url);
    };
   $scope.userDataLoaded = true
     $scope.data = [];
  $scope.filteredData = [];
  $scope.currentPage = 1;
  $scope.itemsPerPage = 6;
  $scope.totalPages = 1;

 
    $http({
      method: 'GET',
      url: 'https://script.google.com/macros/s/AKfycbxN34IjjTFdUaPKeyLFI5-VCzDcBznvBB96B1IbWLAlSbqjISYOTK08Z07XrC2xDuwV/exec',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      } 
    }).then(function(response) {
      $scope.data = shuffleArray(response.data.posts); 
       $scope.profileData = response.data.profiles
      $scope.filterPosts('all');
      $scope.updatePagination();
      $scope.userDataLoaded = false
       
      $scope.feed = response.data.feed;

      
       $scope.data.forEach(post => {
        if (post.type === 'poll') {
            processPollData(post);
        }
    });
      
     
           
    });


 $scope.loadMorePosts = function () {
  $scope.itemsPerPage += 5;
};

      function shuffleArray(array) {
  const shuffled = array.slice(); // copia del array original
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

    $scope.selectedPostForComments = null;

$scope.openComments = function(post) {
  $scope.selectedPostForComments = post;
};

$scope.backToFeed = function() {
  $scope.selectedPostForComments = null;
};
   
    $scope.lvlColor = function(lvl){
  if(lvl == 0){
    return "#F44336"
  }else if(lvl == 1){
    return "#9024dc"
  }else if(lvl == 2){
    return "#1894cc"
  }else if(lvl == 3){
    return "#489454"
  }else if(lvl == 4){
    return "#f0ac14"
  }else if(lvl == 5){
    return "#485cb4"
  }else if(lvl == 6){
    return "#08949c"
  }
}     
     
$scope.getEvent = function(task){
  if(task.split(" ")[0] == "Nivel"){
    return " ha subido de nivel"
  }else{
    return " ha entregado"
  }
}
     
     
     $scope.getLevel = function(lvl){
  if(lvl == 0){
     return "Nivel Preparatorio"
  }else{
    return "Nivel "+lvl.toString()
  }
}
   
   function processPollData(post) {
    post.totalVotes = post.likes.reduce((total, opt) => total + opt.votes.length, 0);
    post.likes.forEach(opt => {
        opt.pct = post.totalVotes > 0 ? (opt.votes.length / post.totalVotes) * 100 : 0;
    });
}
   
$scope.isButton = true;

 $scope.addVote = function(post, opt) {
    if ($scope.isButton) {
        $scope.isButton = false;
      
        opt.votes.push("Usuario");
        processPollData(post);
        opt.animate = false;
       post.likes.forEach(option => {
         option.isButton = false; 
         option.animate = true; 
            });
    } 
};


$scope.showProfileInfo = {};
$scope.toggleProfileInfo = function(postId) {
  $scope.showProfileInfo[postId] = !$scope.showProfileInfo[postId];
};

   
      
    $scope.user = "@anonimo"

 var requestData = { 
        action: "getUserName",
        token: localStorage.getItem('MStoken')
    };

    var config = { 
        headers: {
            "Content-Type": "text/plain;charset=utf-8"
        }
    };

$http.post('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', requestData, config)
    .then(function(response) {
      $scope.user = response.data
    }); 

   
   
     $scope.sendLike = function(postid){
 var requestData = {
        action: "newLike",
        token: localStorage.getItem('MStoken'),
        postid: postid
    };

    var config = {
        headers: {
            "Content-Type": "text/plain;charset=utf-8"
        }
    };

 $http.post('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', requestData, config)
    .then(function(response) {
    });
}



    $scope.sendComment = function(postid, comment){
 var requestData = {
        action: "newComment",
        token: localStorage.getItem('MStoken'),
        comment: comment,
        postid: postid
    };

    var config = {
        headers: {
            "Content-Type": "text/plain;charset=utf-8"
        }
    };
 $http.post('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', requestData, config)
    .then(function(response) {
    });
}
   
   

  $scope.updatePagination = function() {
    $scope.totalPages = Math.ceil($scope.filteredData.length / $scope.itemsPerPage);
    $scope.currentPage = 1;
  };



  $scope.filterPosts = function(type) {
    $scope.filter = type;
   
    if (type === 'all') {
      $scope.filteredData = $scope.data;
    }else if(type === 'both'){
      $scope.filteredData = $scope.data.filter(function(post) {
        return post.type === 'text' || post.type === 'poll';
      });
      
    } else {
      $scope.filteredData = $scope.data.filter(function(post) {
        return post.type === type;
      });
    }
   
  
     $timeout(function() {
            $('.post').hide().fadeIn(400);
        }, 100);
    $scope.updatePagination();
  };


   
$scope.openModal = function(post) {
    $scope.selectedPost = post;
    var userInput = prompt("Agregar comentario:");

    if (userInput !== null) {
        var newComment = { user: $scope.user, comment: userInput };
        
        // Encuentra el objeto correspondiente en $scope.data
        var selectedDataItem = $scope.data.find(item => item.id === $scope.selectedPost.id);
        if (selectedDataItem) {
            // Agrega el nuevo comentario al arreglo de comentarios
            selectedDataItem.comments.push(newComment);
          $scope.sendComment(post.id, userInput)
        }
    }
};
   
   
   
    $scope.newPost = function(data) {
      let ytVideoURL = $('#ytVideoURL').attr('ytVideoURL');
      
      if(ytVideoURL){
        var post =  {
    "user": "Test",
    "type": "youtube",
           "height": 150,
    "url": ytVideoURL,
    "date": [1], 
    "likes": [],
     "comments": []  
        }
      }else{
           var post =  {
          "user": "Test",
          "type": "text",
             "height": 0,
          "url": data,
          "date": [1], 
          "likes": [],
           "comments": []  
        }
     }
    $scope.data.unshift(post)
      $scope.newText = ""; 
       $('#video-details').html('');
     $('#ytVideoURL').attr('ytVideoURL', '');
}
   


   $scope.dangerButtonActive = []; 

$scope.newLike = function(index, post) {
  
    $scope.selectedPost = post;
    var selectedDataItem = $scope.data.find(item => item.id === post.id);

    if (selectedDataItem) {
        const userIndex = selectedDataItem.likes.indexOf($scope.user);

        if (userIndex === -1) {
            // Si no ha dado like, lo agregamos
            selectedDataItem.likes.push($scope.user);
        } else {
            // Si ya dio like, lo quitamos
            selectedDataItem.likes.splice(userIndex, 1);
        }
    }
};
   
   

   
   
$scope.calculateTimeAgo = function(alertDate) {
  const alertDateObj = new Date(alertDate);
  const today = new Date(); // Fecha actual
  const timeDiff = Math.abs(today - alertDateObj); // Diferencia en milisegundos

  const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24)); // Días completos
  const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); // Horas restantes
  const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)); // Minutos restantes

  if (days > 0) {
    return `${days} día(s)`;
  } else if (hours > 0) {
    return `${hours} hora(s)`;
  } else {
    return `${minutes} minuto(s)`;
  }
};


 

   $scope.currentSection = '#about';
   $scope.handleButtonClick = function(section) {
        $scope.currentSection = section;
    };
   $scope.handleUserProfile = function(username) {
      $scope.currentMain = username;
     if(username != "Mozart Appcademy"){
        $('#profileModal').modal('show');
     }
     
    }; 
    
   
   $scope.youtubeModal = function() {
      $('#youtubeModal').modal('show');
    };
 
   
     $scope.filterByLevel = function(lsn) {
    return function(entry) {
    return entry.index <= lsn;
  };
};


   
}]);




  $(document).ready(function () {
  // Inicializa fancybox
  $(".fancybox").fancybox();

  // Evita que el formulario recargue la página
  $('#search-form').submit(function (e) {
    e.preventDefault();
  });

$('#results').on('click', '.select-video', function (e) {
  e.preventDefault();

  // Obtiene los datos del video seleccionado
  let videoTitle = $(this).data('title');
  let videoUrl = $(this).data('url');
  let videoThumbnail = $(this).data('thumb');


  // Actualiza el atributo ytVideoURL con la URL del video
  $('#ytVideoURL').attr('ytVideoURL', videoUrl);

    $('#video-details').html(`
    <div class="video-info" style="position: relative; display: inline-block;">
      <img src="${videoThumbnail}" style="width: 120px; height: 90px; margin-right: 10px;">
      <span>${videoTitle}</span>
       <button 
  class="remove-youtube-btn" 
  style="
    position: absolute; 
    top: -5px; 
    right: -5px; 
    background: red; 
    color: white; 
    border: none; 
    border-radius: 50%; 
    width: 20px; 
    height: 20px; 
    font-size: 15px; 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center;"
>
  <i class="ri-close-fill" style="font-weight: 700; line-height: 0;"></i>
</button>
    </div>
  `);

  $('#video-details').on('click', '.remove-youtube-btn', function () {
  $('#video-details').html('');
  $('#ytVideoURL').attr('ytVideoURL', '');
});
  
  // Cierra el modal
  $('#youtubeModal').modal('hide');
  $('#results').html('');
   $('#query').val('');
});


  
   $('#uploadBtn').on('click', function () {
    $('#uploadImage').click();
  });

  // Maneja la subida de imagen
  $('#uploadImage').on('change', function (event) {
    let file = event.target.files[0]; // Obtén el archivo
    if (file) {
      let reader = new FileReader();

      // Convierte el archivo a Base64
      reader.onload = function (e) {
        let base64Image = e.target.result;

        // Muestra la imagen en el contenedor #img-details
       $('#img-details').html(`
  <div class="uploaded-img-container" style="position: relative; display: inline-block;">
    <img src="${base64Image}" alt="Uploaded Image" style="max-width: 100px; max-height: 100px; border: 1px solid #ccc; border-radius: 5px;">
   <button 
  class="remove-image-btn" 
  style="
    position: absolute; 
    top: -5px; 
    right: -5px; 
    background: red; 
    color: white; 
    border: none; 
    border-radius: 50%; 
    width: 20px; 
    height: 20px; 
    font-size: 15px; 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center;"
>
  <i class="ri-close-fill" style="font-weight: 700; line-height: 0;"></i>
</button>

  </div>
`);

        // Guarda el Base64 en el atributo imgData
        $('#imgData').attr('imgData', base64Image);
      };

      // Lee el archivo como Base64
      reader.readAsDataURL(file);
    }
  });
  
  
  $('#img-details').on('click', '.remove-image-btn', function () {
  // Limpia el contenedor de imagen
  $('#img-details').html('');
  // Limpia el atributo imgData
  $('#imgData').attr('imgData', '');
});
 
}); 

function search() {
  // Limpia resultados anteriores
  $('#results').html('');

  // Obtén el valor del input
  let q = $('#query').val();

 
  $.get(
    "https://www.googleapis.com/youtube/v3/search",
    {
      part: 'snippet, id',
      q: q,
      type: 'video', 
      key: 'AIzaSyBRfk0b73-DtIk7UNdpItlZHlmMtNcVsUA'
    },
    function (data) {
      $.each(data.items, function (i, item) {
        // Genera el HTML de cada resultado
        let output = getOutput(item);

        // Añade los resultados al DOM
        $('#results').append(output);
      });
    }
  );
   
  /*
    var api = "https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec";

    var validationData = {
      redirect: "follow",
      method: "POST",
      headers: {
        "Content-Type": "text/plain;charset=utf-8"
      },
      body: JSON.stringify({
        action: "youtubeApi",
        q: q 
      }),
      credentials: "omit"
    };

  fetch(api, validationData)
  .then(response => response.text())
  .then(res => {
    var validation = JSON.parse(res);
    validation.forEach(item => {
          $('#results').append(getOutput(item));
        });
  })
*/

  
  
  
}

function getOutput(item) {
  // Extrae información del video
  let videoId = item.id.videoId;
  let title = item.snippet.title;
  let description = item.snippet.description;
  let thumb = item.snippet.thumbnails.high.url;
  let channelTitle = item.snippet.channelTitle;

  // Construye el HTML de salida con atributos data-* para los datos
  let output = `
    <li>
      <div class="list-left">
        <img src="${thumb}" alt="${title}">
      </div>
      <div class="list-right">
        <h3 style="font-size: 15px;">
          <a 
            href="#" 
            class="select-video" 
            data-title="${title}" 
            data-url="https://www.youtube.com/embed/${videoId}"
            data-thumb="${thumb}"
            >
            ${title}
          </a>
        </h3>
        <small>por <span class="cTitle">${channelTitle}</span></small>
        <p style="font-size: 10px;">${description}</p>
      </div>
    </li>
    <div class="clearfix"></div>
  `;

  return output;
}
</script>
