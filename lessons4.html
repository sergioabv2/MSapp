<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Quest Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>

<style>
/* Variables CSS */
:root {
    --primary: #2563EB; /* Azul Mozart+ */
    --sidebar-bg: #F9FAFB;
    --sidebar-border: #E5E7EB;
    --text-main: #111827;
    --text-light: #6B7280;
    --bg-white: #FFFFFF;
    --success: #10B981;
    --danger-red: #dc3545;
    --font-mono: 'JetBrains Mono', monospace;
}

* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: var(--text-color);
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    height: 100vh;
    overflow: hidden;
    transition: background-color 0.3s, color 0.3s;
}

#app, #levelSelector, #pianoApp {
    height: 100%;
}

/* ========== SELECTOR DE NIVELES ========== */
#levelSelector {
    flex: 1;
    overflow-y: auto;
    min-height: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 100px;
    padding: 120px 0 0 0;
    position: relative;
    z-index: 2;
}

.level-container {
    display: grid;
    grid-template-columns: 230px 1fr;
    gap: 15px;
    max-width: 1200px;
    width: 100%;
    padding: 20px;
    position: relative;
    padding-top: 160px; 
    padding-bottom: 60px;
    z-index: 2;
}

.level-header {
    background: var(--sidebar-bg);
    color: var(--sidebar-text);
    padding: 40px 30px;
    text-align: center;
}

.level-header h1 { 
    font-size: 2.2rem; 
    margin-bottom: 12px; 
}

.level-header p { 
    font-size: 1.1rem; 
    opacity: 0.9; 
}

.levels-grid {
    display: flex;
    flex-direction: column;
    gap: 24px; /* Espacio entre tarjetas */
    padding: 0 20px;
    max-width: 1000px;
    position: relative;
    z-index: 10;
}

.level-card {
    position: relative;
    height: 165px;
    width: 100%;
    background-color: #ffffff; /* Fondo base blanco */
    border-radius: 16px;
    overflow: hidden;
     box-shadow: 0 5px 10px rgba(0,0,0,0.1), 0 2px 10px rgba(0,0,0,0.05);
    cursor: pointer;
    transition: all 0.3s ease;
  /*  border: 1px solid rgba(0,0,0,0.3);  */
}

/* Interacción Hover */
.level-card:hover {
    box-shadow: 0 7px 12px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08);
    
    border-color: rgba(0,0,0,0.1);
}

/* Imagen de Fondo (La textura) */
.card-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover;
    background-position: center;
    transition: transform 0.6s ease;
    z-index: 0;
    /* Truco: Filtro para que la imagen no compita con el texto */
  /*  filter: grayscale(20%) contrast(0.9); */
}





.lock-icon {
    position: absolute;
    right: 30px;
    top: 30px;
    font-size: 1.5rem;
    color: rgba(255,255,255,0.5);
    z-index: 2;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    border-radius: 50%;
    backdrop-filter: blur(4px);
}

/* Estado bloqueado */

.level-card.locked {
    cursor: default;
    filter: grayscale(100%);
    box-shadow: none;
   
}
.level-card.locked .card-overlay {
    backdrop-filter: blur(10px) ;
    -webkit-backdrop-filter: blur(10px) ;
    background: linear-gradient(90deg, 
                rgba(0, 0, 0, 0.2) 0%, 
                rgba(0, 0, 0, 0.1) 50%, 
                rgba(0, 0, 0, 0.02) 100%);
    opacity: 0.33;
    z-index: 1; /* Asegura que esté sobre la imagen (.card-bg) */
}
.level-card.locked:hover {
    transform: none;
    box-shadow: none;
}

.card-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;

    z-index: 1;
}

/* Contenido del Texto */
.card-content {
    position: relative;
    z-index: 2;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding-left: 40px;
    color: black;
}

.level-number {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #8B5CF6, #A855F7);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: black;
    font-size: 20px;
    font-weight: 600;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
}

.level-info {
    flex: 1;
    min-width: 0;
}

.phase-tag {
    font-family: 'Inter', sans-serif;
    text-transform: uppercase;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 1px;
    color: gray;
    margin-bottom: 8px;
}

.level-title {
    font-family: 'Inter', sans-serif;
    font-size: 2rem;
    font-weight: 700;
   
    margin: 0 0 10px 0;
    line-height: 1;
    color: black;
}



.level-meta {
    font-size: 0.9rem;
    font-weight: 500;
    color: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    gap: 10px;
}

.time-icon {
    width: 16px;
    height: 16px;
    opacity: 0.6;
}

.time-text {
    color: #8B5CF6;
    font-size: 14px;
    font-weight: 500;
}

.progress-container2 {
    width: 190px;
    height: 12px;
    background: #f0f0f0;
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.progress-bar2 {
    height: 100%;
    background: linear-gradient(90deg, #8B5CF6, #A855F7);
    border-radius: 2px;
    width: 0%;
    transition: width 0.5s ease-out;
}

.lockLvlIco {
    position: absolute;
    font-size: 20px;
    right: 15px;
    top: 15px;
}

/* ========== APP DE PIANO ========== */
#pianoApp { 
    display: flex; 
    flex-direction: column; 
    height: 100vh;
}

/* NAVBAR SUPERIOR */
.top-nav {
    height: 60px;
    background: var(--bg-white);
    border-bottom: 1px solid var(--sidebar-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    flex-shrink: 0;
    z-index: 10;
}

.nav-left { display: flex; align-items: center; gap: 16px; }
.back-btn {
    text-decoration: none;
    color: var(--text-light);
    display: flex; align-items: center; gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
}
.back-btn:hover { color: var(--primary); }
.course-title { font-weight: 600; font-size: 1rem; color: var(--text-main); }

.nav-right { display: flex; align-items: center; gap: 16px; }
.progress-summary { font-size: 0.85rem; color: var(--text-light); }
.progress-bar-mini {
    width: 100px; height: 6px; background: #E5E7EB; border-radius: 3px; overflow: hidden;
}
.progress-fill-mini { height: 100%; background: var(--success); transition: width 0.3s ease; }

.app-container { 
    display: flex; 
    flex: 1; 
    overflow: hidden; 
}

/* SIDEBAR (A LA DERECHA) */
.sidebar { 
    width: 320px; 
    background-color: var(--sidebar-bg);
    border-left: 1px solid var(--sidebar-border); 
    display: flex; 
    flex-direction: column; 
    padding: 0; 
    flex-shrink: 0; 
    overflow-y: auto;
}

.main-content { 
    flex: 1; 
    background-color: var(--bg-white);
    overflow-y: auto;
    position: relative;
}

.video-container {
    width: 100%;
    background: #000;
    aspect-ratio: 16 / 9;
    position: relative;
}

/* CONTROLES DE LECCIÓN */
.lesson-controls {
    padding: 24px 40px;
    border-bottom: 1px solid var(--sidebar-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.current-lesson-h1 { font-size: 1.5rem; font-weight: 700; color: var(--text-main); margin-bottom: 4px; }
.lesson-meta-info { color: var(--text-light); font-size: 0.9rem; }

.nav-buttons { display: flex; gap: 12px; }
.btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex; align-items: center; gap: 8px;
    transition: all 0.2s;
    border: none;
}
.btn-outline { border: 1px solid #D1D5DB; background: white; color: var(--text-main); }
.btn-outline:hover:not(:disabled) { background: #F9FAFB; border-color: #9CA3AF; }
.btn-outline:disabled { opacity: 0.5; cursor: not-allowed; }

.btn-primary { background: var(--text-main); color: white; }
.btn-primary:hover:not(:disabled) { background: #333; }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

/* TABS Y DESCRIPCIÓN */
.tabs-container { padding: 0 40px; margin-top: 24px; }
.tabs-header {
    display: flex;
    gap: 32px;
    border-bottom: 1px solid var(--sidebar-border);
    margin-bottom: 24px;
}
.tab-link {
    padding-bottom: 12px;
    font-weight: 500;
    color: var(--text-light);
    cursor: pointer;
    position: relative;
}
.tab-link.active { color: var(--primary); }
.tab-link.active::after {
    content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary);
}

.tab-content { max-width: 800px; padding-bottom: 60px; line-height: 1.7; color: var(--text-main); }

/* SIDEBAR ITEMS */
.module-header {
    padding: 16px 20px;
    background: #F3F4F6;
    border-bottom: 1px solid var(--sidebar-border);
    border-top: 1px solid var(--sidebar-border);
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-main);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.module-header:first-child { border-top: none; }
.module-header i { transition: transform 0.3s; color: var(--text-light); }
.module-header.expanded i { transform: rotate(180deg); }

.lesson-list { list-style: none; overflow: hidden; transition: max-height 0.3s ease; }

.lesson-item {
    display: flex;
    align-items: flex-start;
    padding: 14px 20px;
    border-bottom: 1px solid rgba(0,0,0,0.03);
    cursor: pointer;
    transition: background 0.2s;
    gap: 12px;
}
.lesson-item:hover { background: rgba(0,0,0,0.03); }
.lesson-item.active {
    background: #EFF6FF;
    border-left: 3px solid var(--primary);
}
.lesson-item.active .task-title { color: var(--primary); font-weight: 600; }

.status-icon { margin-top: 2px; color: #D1D5DB; flex-shrink: 0; font-size: 1.2rem; }
.status-icon.completed { color: var(--success); }

.task-info { display: flex; flex-direction: column; gap: 2px; }
.task-title { font-size: 0.9rem; line-height: 1.4; color: #374151; }
.task-type-tag { font-size: 0.7rem; color: #9CA3AF; text-transform: uppercase; font-weight: 600; }













/* ========== BANNER ========== */
.banner-header {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 240px;
    overflow: hidden;
    will-change: transform, opacity;
    z-index: 1;
}

.banner-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center 40%;
}

.banner-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, 
                rgba(248, 249, 250, 0.35) 0%, 
                rgba(248, 249, 250, 0.25) 50%, 
                rgba(248, 249, 250, 1) 100%);
}

.banner-text {
    position: absolute;
    top: 50%;
    left: 6%;
    transform: translateY(-50%);
    z-index: 5;
    color: #1a1a1a;
    text-shadow: 0 4px 12px rgba(0,0,0,0.1); 
}

.banner-text h1 {
    font-size: 42px;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 8px;
}

.banner-text .subtitle {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--accent-red);
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.pending-tasks {
    background-color: var(--main-content-bg);
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    height: fit-content;
}

.pending-tasks h4 {
    margin-bottom: 15px;
    font-size: 1rem;
    color: var(--text-color);
}

.pending-tasks ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.pending-tasks li {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.pending-tasks li.completed {
    opacity: 0.5;
}

.pending-tasks li.completed .task-info .info {
    text-decoration: line-through;
    color: #9ca3af;
}

.pending-tasks li.completed .task-icon {
    color: #28a745;
}

.pending-tasks li.completed .task-icon i::before {
    content: '\EB7B';
}

.pending-tasks li.completed {
    transition: all 0.3s ease;
}

.task-icon {
    font-size: 1.5rem;
    color: var(--primary-accent);
    margin-right: 15px;
}

.task-info span {
    display: block;
    font-size: 0.8rem;
    color: #6c757d;
}

.task-info .info {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-color);
    text-decoration: none;
}

.view-all-tasks {
    display: block;
    margin-top: 10px;
    text-align: right;
    font-size: 0.9rem;
    color: var(--primary-accent);
    text-decoration: none;
    font-weight: 600;
}

.sidebar-wrapper {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.practice-card {
    background-color: var(--main-content-bg);
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    height: fit-content;
}

.practice-card h4 {
    margin-bottom: 10px;
    font-size: 1rem;
    color: var(--text-color);
}

.practice-card p {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 15px;
    line-height: 1.4;
}

.btn-shiny {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #8B5CF6 0%, #6366f1 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-shiny:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    filter: brightness(110%);
}

.btn-shiny i {
    font-size: 1.2rem;
}

@media (max-width: 900px) {
    .sidebar-wrapper {
        display: none;
    }
}

/* ========== QUIZ ========== */
.quiz-options { 
    display: flex; 
    flex-direction: column; 
    gap: 10px; 
    margin: 20px 0; 
}

.quiz-option { 
    padding: 12px; 
    border: 1px solid var(--medium-gray); 
    color: var(--text-color); 
    background-color: transparent; 
    border-radius: 5px; 
    cursor: pointer; 
    transition: background-color 0.2s;
}

.quiz-option:hover { 
    background-color: var(--lesson-header-hover); 
}

.sidebar-overlay { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.5); 
    z-index: 1000; 
    opacity: 0; 
    visibility: hidden; 
    transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; 
}

.sidebar-overlay.is-active { 
    opacity: 1; 
    visibility: visible; 
}

.lesson-navigation {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    width: 100%;
}

.nav-card {
    flex: 1;
    border: 1px solid #e5e5e7;
    border-radius: 12px;
    padding: 20px 24px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-width: 0; /* Evita desbordamiento de texto */
}

.nav-card:hover {
    border-color: #d2d2d7;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    transform: translateY(-1px);
}

.nav-card.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: #f9f9f9;
}

.nav-card.disabled:hover {
    transform: none;
    box-shadow: none;
    border-color: #e5e5e7;
}

.nav-label {
    font-size: 0.85rem;
    color: #86868b;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    text-transform: capitalize;
}

.nav-card.next .nav-label {
    justify-content: flex-end;
}

.nav-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1d1d1f;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.nav-card.next .nav-title {
    text-align: right;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 900px) {
    .pending-tasks {
        display: none; 
    }

    .level-container {
        grid-template-columns: 1fr;
        gap: 0;
        padding: 10px;
        padding-top: 160px; 
    }
}

@media (max-width: 800px) {
    .levels-grid { 
        grid-template-columns: 1fr; 
        padding: 30px 20px; 
    }
    
    .level-header { 
        padding: 30px 20px; 
    }
    
    .level-header h1 { 
        font-size: 1.8rem; 
    }
    
    .app-header {
        display: flex; 
        align-items: center; 
        justify-content: center;
        padding: 0 15px; 
        height: 45px;
        position: fixed; 
        top: 0; 
        width: 100%; 
        z-index: 999;
        background-color: var(--header-bg);
    }
    
    .menu-toggle-btn { 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        top: 50px; 
        left: 15px; 
        right: auto; 
    }
    
    .sidebar { 
        position: fixed; 
        top: 0; 
        right: 0; 
        height: 100%; 
        width: 300px; 
        max-width: 80%; 
        z-index: 1001; 
        transform: translateX(100%); 
        transition: transform 0.3s ease-in-out; 
        border-left: 1px solid var(--lesson-header-bg); 
        border-right: none; 
    }
    
    .sidebar.is-open { 
        transform: translateX(0); 
    }

    .video-wrapper {
        height: 300px;
        min-height: 300px;
    }
    
    .content-below {
        padding: 20px 15px;
    }
}

@media (max-width: 550px) { 
    .lesson-navigation {
        flex-direction: column;
        gap: 10px;
    }
    .nav-card.next .nav-label, .nav-card.next .nav-title {
        justify-content: flex-start;
        text-align: left;
    }
    .level-card {
        transform: none !important; /* Resetea el 0.9 */
        width: 100%; /* Que ocupe el ancho disponible */
        margin: 0 0 10px 0; /* Espaciado vertical natural */
    }
    .level-card:hover,
    .level-card.locked:hover {
        transform: none !important; 
    }
    .progress-container-bottom{
      width: 200px;
    }
   
    
    .level-title {
        font-size: 1.5rem; /* Texto más pequeño naturalmente */
    }
    .levels-grid {
        padding: 5px 15px; /* Menos padding lateral */
        width: 100%;

    }
    
    .mobile {
        display: none;
    }
    
    .player-header {
        justify-content: space-between;
    }
    
    .banner-text {
        left: 20px;
        right: 20px;
        max-width: 100%;
    }

    .banner-text h1 {
        font-size: 32px;
    }

    .floating-header { padding: 15px; }
}

/* ========== LOADER DE CARGA ========== */
.loader-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
}

.banner-loader {
    position: absolute;
    bottom: 25px;
    right: 30px;
    z-index: 10;
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(5px);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(0,0,0,0.05);
    color: #4b5563;
    font-size: 0.85rem;
    font-weight: 600;
    transition: opacity 0.3s ease;
}

@keyframes ri-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.ri-spin {
    animation: ri-spin 1s linear infinite;
}

.loader-content {
    background: white;
    border-radius: 16px;
    padding: 32px 40px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    border: 1px solid #e5e5e7;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 350px;
    width: 90%;
}

.loader-content i {
    font-size: 3.5rem;
    margin-bottom: 16px;
    display: inline-block;
    color: var(--primary-accent, #6f42c1);
}

.loader-content p {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1d1d1f;
    margin: 0;
}

.blur-content {
    pointer-events: none;
}
</style>

<body>
<div id="app">
    <!-- BANNER -->
    <div class="banner-header" v-show="currentView === 'levelSelector'">
        <img src="https://lh3.googleusercontent.com/d/1Lc5TgnQopT5_tK1qbXBAOgiDODlcyRp4=s800" class="banner-image">
        <div class="banner-overlay"></div>
        <div class="banner-text">
            <h1>
                <span class="subtitle">Lecciones de Piano</span>
                Classroom
            </h1>
            <p style="color: #596275; margin-top: 10px; font-weight: 500;">
                Sistema de aprendizaje secuencial. 
            </p>
        </div>
        <div class="banner-loader" v-show="isLoading">
            <i class="ri-loader-4-line ri-spin"></i>
            <span>Actualizando...</span>
        </div>
    </div>

    <!-- SELECTOR DE NIVELES -->
    <div id="levelSelector" ref="levelSelectorRef" v-show="currentView === 'levelSelector'">
        <div class="level-container">
            <div class="sidebar-wrapper">
                <div class="pending-tasks">
                    <h4>Tareas Pendientes</h4>
                    <ul v-if="pendingTasks.length > 0">
                        <li v-for="task in pendingTasks" :key="task.taskIndex" :class="{'completed': task.completed}">
                            <div class="task-icon"><i :class="task.iconClass"></i></div>
                            <div class="task-info">
                                <span>{{ task.lessonTitle }}</span>
                                <div class="info">{{ task.taskTitle }}</div>
                            </div>
                        </li>
                    </ul>
                    <div v-if="pendingTasks.length === 0" style="text-align: center; color: #6e6e73; padding: 20px;">
                        <i class="ri-checkbox-circle-line" style="font-size: 2rem; color: #28a745;"></i>
                        <p style="margin-top: 10px;">¡No tienes tareas pendientes!</p>
                    </div>
                </div>

                <div class="practice-card">
                    <h4>Práctica libre</h4>
                    <p>Explora el teclado sin límites o practica tus canciones favoritas.</p>
                    <button class="btn-shiny" onclick="window.location.href='https://www.mozart-app.com/bookfinder'">
                        <i class="ri-piano-line"></i> Empezar
                    </button>
                </div>
            </div>
      
          <div class="levels-grid">
    <div class="level-card" 
         v-for="(level, index) in levels" 
         :key="level.id"
         @click="selectLevel(level)"
         :class="{'locked': currentLevelIndex < level.id}">
        
       <div class="card-bg" 
     :style="{ backgroundImage: `url(${level.image})` }">
</div>

        <div class="card-overlay"></div>

        <div class="card-content">
            <div class="phase-tag">Grado {{ level.id  }}</div> <h2 class="level-title">{{ level.title }}</h2>
            
            <div class="level-meta">
                <i class="ri-article-line"></i> {{ level.duration }}
                <span style="margin: 0 5px;">•</span>
                <span>{{ level.progress }}% Completado</span>
            </div>
             <div class="progress-container-bottom">
                <div class="progress-bar-fill" :style="{width: level.progress + '%'}"></div>
              </div>
        </div>

        <div class="lock-icon" v-if="currentLevelIndex < level.id">
            <i class="ri-lock-fill"></i>
        </div>

       
    </div>
</div>
        </div>
    </div>

    <!-- APP DE PIANO -->
    <div id="pianoApp" v-show="currentView === 'app'">
        <!-- NAVBAR SUPERIOR -->
        <nav class="top-nav">
            <div class="nav-left">
                <a class="back-btn" @click.prevent="showLevelSelector">
                    <i class="ri-arrow-left-line"></i>
                    Volver al Dashboard
                </a>
                <span style="color:#E5E7EB">|</span>
                <span class="course-title">{{ selectedLevel?.title }}</span>
            </div>
            <div class="nav-right">
                <div class="progress-summary">{{ progress }}% Completado</div>
                <div class="progress-bar-mini">
                    <div class="progress-fill-mini" :style="{width: progress + '%'}"></div>
                </div>
            </div>
        </nav>

        <div class="app-container">
            <main class="main-content">
                <div class="video-container" v-show="showingVideo">
                    <div id="player" style="width: 100%; height: 100%;"></div>
                    
                    <!-- Modal de Pausa -->
                    <div id="pauseModal" class="video-modal-overlay">
                        <div class="video-modal-content">
                            <h2 style="color: #f59e0b;">¡Atención!</h2>
                            <p>Debes terminar de ver el video para poder avanzar. Por favor, reanuda el video.</p>
                            <button id="closePauseButton" class="modal-button" style="background-color: #f59e0b; color: white; border: none;">
                                Cerrar y Reanudar
                            </button>
                        </div>
                    </div>

                    <!-- Modal de Video Terminado -->
                    <div id="finishedModal" class="video-modal-overlay">
                        <div class="video-modal-content">
                            <h2 style="color: #10b981;">¡Video Terminado!</h2>
                            <p>Has completado el video. ¡Ahora puedes continuar con la siguiente actividad!</p>
                            <button id="continueVideoButton" class="modal-button" style="background: linear-gradient(135deg, #8B5CF6, #A855F7); color: white; border: none;">Continuar</button>
                        </div>
                    </div>
                </div>
                
                <iframe id="content-iframe" 
                        :src="currentTaskUrl" 
                        title="Contenido principal" 
                        style="width: 100%; height: 60vh; border: none;"
                        v-show="!showingVideo"></iframe>

                <!-- Controles de Lección -->
                <div class="lesson-controls" v-if="currentViewingTask">
                    <div>
                        <h1 class="current-lesson-h1">{{ currentViewingTask.title }}</h1>
                        <p class="lesson-meta-info">
                            Lección {{ viewingLessonIndex + 1 }}: {{ lessons[viewingLessonIndex]?.title }} • Unidad {{ lessons[viewingLessonIndex]?.unit }}
                        </p>
                    </div>
                    <div class="nav-buttons">
                        <button class="btn btn-outline" :disabled="!prevTaskInfo" @click="viewTask(prevTaskInfo.lIdx, prevTaskInfo.tIdx)">
                            Anterior
                        </button>
                        <button class="btn btn-primary" :disabled="nextTaskInfo?.locked" @click="handleNext">
                            {{ (viewingLessonIndex === currentLessonIndex && viewingTaskIndex === currentTaskIndex && currentViewingTask.type !== 'video') ? 'Completar y Siguiente' : 'Siguiente' }}
                            <i class="ri-arrow-right-line"></i>
                        </button>
                    </div>
                </div>

                <!-- Tabs y Descripción -->
                <div class="tabs-container" v-if="currentViewingTask">
                    <div class="tabs-header">
                        <div class="tab-link active">Descripción</div>
                        <div class="tab-link" v-if="currentViewingTask.objective?.length > 0">Objetivos</div>
                    </div>

                    <div class="tab-content">
                        <p style="margin-bottom: 24px;">{{ currentViewingTask.instructions }}</p>
                        
                        <div v-if="currentViewingTask.tip" style="background: #FFFBEB; border-left: 4px solid #F59E0B; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <p style="color: #92400E; font-weight: 600; font-size: 0.9rem; margin-bottom: 4px;">
                                <i class="ri-flashlight-line"></i> Consejo experto
                            </p>
                            <p style="color: #92400E; margin: 0;">{{ currentViewingTask.tip }}</p>
                        </div>

                        <div v-if="currentViewingTask.objective?.length > 0">
                            <h3 style="font-size: 1rem; font-weight: 700; margin-bottom: 12px;">Lo que aprenderás:</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li v-for="obj in currentViewingTask.objective" style="display: flex; gap: 12px; margin-bottom: 10px; color: var(--text-light);">
                                    <i class="ri-checkbox-circle-line" style="color: var(--success); font-size: 1.2rem;"></i>
                                    {{ obj }}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </main>

            <aside class="sidebar">
                <template v-for="(lesson, lessonIndex) in lessons" :key="lessonIndex">
                    <div class="module-header" :class="{'expanded': lesson.expanded}" @click="toggleLesson(lesson, lessonIndex)">
                        {{ lessonIndex + 1 }}. {{ lesson.title }}
                        <i class="ri-arrow-down-s-line"></i>
                    </div>
                    <ul class="lesson-list" :style="{ maxHeight: lesson.expanded ? '1000px' : '0' }">
                        <li class="lesson-item" 
                            v-for="(task, taskIndex) in lesson.tasks" 
                            :key="taskIndex"
                            @click="viewTask(lessonIndex, taskIndex)"
                            :class="{'active': viewingLessonIndex === lessonIndex && viewingTaskIndex === taskIndex}">
                            
                            <i class="status-icon" :class="[
                                task.completed ? 'ri-checkbox-circle-fill completed' : 'ri-checkbox-blank-circle-line',
                                (lessonIndex > currentLessonIndex || (lessonIndex === currentLessonIndex && taskIndex > currentTaskIndex)) ? 'ri-lock-fill' : ''
                            ]"></i>
                            
                            <div class="task-info">
                                <div class="task-title">{{ task.title }}</div>
                                <div class="task-type-tag">{{ task.type }}</div>
                            </div>
                        </li>
                    </ul>
                </template>
            </aside>
        </div>
    </div>
        
        <div class="modal-overlay" id="modalOverlay" :style="{display: modal.show ? 'flex' : 'none'}">
            <div class="modal-content" id="modalContent" v-html="modal.content"></div>
        </div>
        
        <div class="sidebar-overlay" id="sidebarOverlay" :class="{'is-active': sidebarOpen}" @click="toggleSidebar"></div>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const { createApp, ref, reactive, computed, onMounted, nextTick, watch } = Vue;

createApp({
    setup() {
        // ==========================================
        // SECCIÓN 1: ESTADO REACTIVO
        // ==========================================
        
        // Vistas y UI
        const currentView = ref('levelSelector');
        const isLoading = ref(true);
        const sidebarOpen = ref(false);
        const showingVideo = ref(false);
        
        // Índices de navegación
        const currentLevelIndex = ref(0);
        const currentLessonIndex = ref(0);
        const currentTaskIndex = ref(0);
        const viewingLessonIndex = ref(0);
        const viewingTaskIndex = ref(0);
        
        // Progreso
        const totalTasksCompleted = ref(0);
        const totalTasks = ref(0);
        const progress = ref(0);
        
        // Datos del servidor
        const serverLevelIndex = ref(0);
        const serverLessonIndex = ref(0);
        
        // Contenido
        const selectedLevel = ref(null);
        const lessons = ref([]);
        const pendingTasks = ref([]);
        const savedProgress = ref({});
        const currentViewingTask = ref(null);
        const currentTaskUrl = ref('');
        
        // Modal
        const modal = reactive({ show: false, content: '' });
        
        // Niveles (debes importar o definir tu estructura de datos)
       const levels = ref([
            { 
                id: 0, 
                title: 'Nivel Preparatorio', 
                image: 'https://lh3.googleusercontent.com/d/1T7Mx_p-5h8gTEWs5lduvBfHzavl-hjW_=s600',
                description: 'Empieza desde cero. Aprenderás la postura, las notas y tus primeras melodías simples.', 
                duration: '10 lecciones',
                progress: 0,
                lessons: [
                    {
                        title: "Lección 1: Fundamentos",
                        unit: 1,
                        description: "En esta lección aprenderás el concepto de rítmo y métrica, como usar un metrónomo, la posición de las manos y la posición de Do.",
                        tasks: [
                            { type: 'video', title: "Ritmo y Posición de Do", videoId: "Q4r5gnfAtzs", iconClass: 'ri-play-circle-line', instructions: "Mira este video con mucha atención. Aprenderás los fundamentos del ritmo y cómo encontrar la posición de Do en el piano.", tip: "No te saltes partes. Puedes pausar y tomar notas si lo necesitas.", objective: ["Comprender el concepto de ritmo y métrica", "Aprender a localizar la posición de Do", "Tocar tus primeras notas"] },
                            { type: 'exercise', title: "Ode to Joy - var1", contentUrl: "https://drive.google.com/file/d/13I13Ec1sCqw8TNVQ98wSuGuSeJS6EEAr/preview", iconClass: 'ri-todo-line', instructions: "Practica esta primera variación de Ode to Joy usando la posición de Do que acabas de aprender.", tip: "Comienza muy lento. Es mejor tocar despacio y correcto que rápido con errores.", objective: ["Aplicar la posición de Do en una melodía conocida", "Desarrollar coordinación básica", "Mantener un tempo constante"] },
                            { type: 'exercise', title: "Ejercicios en Posición de Do", contentUrl: "https://drive.google.com/file/d/1s5bZw8XCq5cHPcDgOniZSqwpmc6xcKYG/preview", iconClass: 'ri-todo-line', instructions: "Completa estos ejercicios diseñados para fortalecer tu técnica en la posición de Do.", tip: "Presta atención a la digitación sugerida. Los números indican qué dedo usar.", objective: ["Fortalecer la memoria muscular en posición de Do", "Mejorar la precisión de las notas", "Practicar cambios de dedo suaves"] },
                            { type: 'video', title: "Melodía y Armonía", videoId: "bVWXlV8Neic", iconClass: 'ri-play-circle-line', instructions: "Observa cómo la melodía y la armonía trabajan juntas para crear música completa.", tip: "Identifica cuál mano toca la melodía y cuál toca el acompañamiento.", objective: ["Distinguir entre melodía y armonía", "Comprender el rol de cada mano", "Prepararte para tocar con ambas manos simultáneamente"] },
                            { type: 'exercise', title: "Ode to Joy - var2", contentUrl: "https://drive.google.com/file/d/1ijz--ytWa1WkdnngZW3sO6ukzAKCphZt/preview", iconClass: 'ri-todo-line', instructions: "Toca esta segunda variación que incorpora armonía básica con la mano izquierda.", tip: "Practica cada mano por separado primero, luego júntalas lentamente.", objective: ["Coordinar ambas manos tocando juntas", "Aplicar conceptos de melodía y armonía", "Desarrollar independencia entre las manos"] },
                            { type: 'quiz', title: "Quiz de Review", contentUrl: "https://mozart-app.com/lessons/quiz", iconClass: 'ri-question-line', instructions: "Responde estas preguntas para verificar tu comprensión de los conceptos fundamentales.", tip: "Si fallas alguna pregunta, revisa el contenido correspondiente antes de continuar.", objective: ["Evaluar tu comprensión de ritmo y métrica", "Verificar conocimiento de la posición de Do", "Reforzar conceptos de melodía y armonía"] }
                        ]
                    },
                    {
                        title: "Lección 2: Grand Staff",
                        unit: 1,
                        description: "En esta lección aprenderás la postura correcta, la posición de las manos y tus primeras notas en el piano.",
                        tasks: [
                            { type: 'video', title: "El Grand Staff", videoId: "HHF95sBbmwQ", iconClass: 'ri-play-circle-line', instructions: "Aprende a leer el pentagrama completo con las claves de Sol y Fa juntas.", tip: "Memoriza que la clave de Sol es para la mano derecha y la clave de Fa para la izquierda.", objective: ["Comprender la estructura del Grand Staff", "Identificar notas en ambas claves", "Relacionar el pentagrama con las teclas del piano"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1Ys_fybQsMIjS4zaCRLO9lV8qsvmvooXq/preview", iconClass: 'ri-todo-line', instructions: "Practica la lectura de notas en el Grand Staff con estos ejercicios progresivos.", tip: "Di el nombre de cada nota en voz alta antes de tocarla para reforzar el aprendizaje.", objective: ["Mejorar la lectura a primera vista", "Reconocer rápidamente notas en ambas claves", "Desarrollar fluidez en la lectura musical"] },
                            { type: 'exercise', title: "Ode to Joy - var3", contentUrl: "https://www.mozart-app.com/xml2?file=Ode to Joy.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta esta variación leyendo directamente del Grand Staff completo.", tip: "Usa el reproductor interactivo para escuchar cómo debe sonar antes de practicar.", objective: ["Aplicar lectura del Grand Staff en una pieza musical", "Integrar conocimientos previos", "Ganar confianza en la lectura de partituras"] }
                        ]
                    },
                    {
                        title: "Lección 3: Dirección",
                        unit: 1,
                        tasks: [
                            { type: 'video', title: "Intervalos de 2da y 3era", videoId: "H4x0TPlSoaQ", iconClass: 'ri-play-circle-line', instructions: "Descubre cómo se mueven las notas por pasos (2das) y saltos pequeños (3eras) en el teclado.", tip: "Los intervalos son la distancia entre dos notas. Practica identificarlos visualmente en el pentagrama.", objective: ["Reconocer intervalos de 2da y 3era", "Comprender el movimiento melódico", "Tocar intervalos con precisión"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1Dom_0ZjNoslBKZpUa3IUDN8XMzcxZ1Jd/preview", iconClass: 'ri-todo-line', instructions: "Completa estos ejercicios para dominar el reconocimiento y ejecución de intervalos de 2da y 3era.", tip: "Observa la dirección del movimiento: ¿la nota sube o baja? Esto te ayudará a anticipar.", objective: ["Practicar intervalos ascendentes y descendentes", "Mejorar la lectura direccional", "Desarrollar anticipación visual"] }
                        ]
                    },
                    {
                        title: "Lección 4: Intervalos",
                        unit: 1,
                        tasks: [
                            { type: 'video', title: "Intervalos de 4ta y 5ta", videoId: "M6DCHr2wVh8", iconClass: 'ri-play-circle-line', instructions: "Explora intervalos más grandes que crean sonidos característicos en la música.", tip: "Las 5tas suenan muy estables y potentes. Las 4tas tienen un sonido abierto y brillante.", objective: ["Identificar intervalos de 4ta y 5ta", "Comprender sus cualidades sonoras", "Tocar saltos más amplios con precisión"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1G3Cun9yL_xl8ZJUhDJE5CAYTXMQUCIZY/preview", iconClass: 'ri-todo-line', instructions: "Practica estos ejercicios que combinan todos los intervalos aprendidos hasta ahora.", tip: "Los saltos grandes requieren preparación visual. Mira con anticipación dónde irán tus dedos.", objective: ["Dominar intervalos de 4ta y 5ta", "Combinar diferentes tipos de intervalos", "Mejorar la precisión en saltos"] },
                            { type: 'exercise', title: "Teoría", contentUrl: "https://drive.google.com/file/d/1PmVBq1jbKZyFOK3T-CWDNhZ7Tba428Lr/preview", iconClass: 'ri-question-line', instructions: "Refuerza tu comprensión teórica de los intervalos con estos ejercicios escritos.", tip: "Entender la teoría te ayudará a aprender piezas más rápido en el futuro.", objective: ["Consolidar conocimiento teórico de intervalos", "Identificar intervalos en partituras", "Conectar teoría con práctica"] }
                        ]
                    },
                    {
                        title: "Lección 5: Frases",
                        unit: 2,
                        tasks: [
                            { type: 'video', title: "Construcción de Frases", videoId: "RJnwVQHexW0", iconClass: 'ri-play-circle-line', instructions: "Aprende cómo las notas se agrupan en frases musicales, similar a las oraciones en el lenguaje.", tip: "Las frases musicales tienen un inicio, desarrollo y final. Respira entre frases como al hablar.", objective: ["Comprender el concepto de frase musical", "Identificar frases en partituras", "Tocar con expresión natural"] },
                            { type: 'exercise', title: "Práctica de Frases", contentUrl: "https://mozart-app.com/lessons/text", iconClass: 'ri-file-text-line', instructions: "Trabaja estos ejercicios prestando atención especial a la forma de las frases.", tip: "Levanta ligeramente las manos al final de cada frase para crear separación natural.", objective: ["Aplicar fraseo en ejercicios prácticos", "Desarrollar sensibilidad musical", "Crear interpretaciones más expresivas"] },
                            { type: 'quiz', title: "Quiz de Review", contentUrl: "https://mozart-app.com/lessons/quiz", iconClass: 'ri-question-line', instructions: "Responde estas preguntas para verificar tu comprensión de los conceptos fundamentales.", tip: "Si fallas alguna pregunta, revisa el contenido correspondiente antes de continuar.", objective: ["Evaluar tu comprensión de ritmo y métrica", "Verificar conocimiento de la posición de Do", "Reforzar conceptos de melodía y armonía"] },
                            { type: 'exercise', title: "Práctica de Frases", contentUrl: "https://drive.google.com/file/d/1gum-qE-LUdxxRNmjh39A1xImbqYRABAX/preview", iconClass: 'ri-todo-line', instructions: "Trabaja estos ejercicios prestando atención especial a la forma de las frases.", tip: "Levanta ligeramente las manos al final de cada frase para crear separación natural.", objective: ["Aplicar fraseo en ejercicios prácticos", "Desarrollar sensibilidad musical", "Crear interpretaciones más expresivas"] },
                            { type: 'exercise', title: "Run Away River", contentUrl: "https://www.mozart-app.com/xml2?file=Run Away River.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta esta pieza aplicando todo lo aprendido sobre frases musicales.", tip: "Imagina que estás contando una historia. Cada frase es parte de la narrativa.", objective: ["Ejecutar una pieza completa con buen fraseo", "Demostrar comprensión musical", "Expresar musicalidad personal"] }
                        ]
                    },
                    {
                        title: "Lección 6: Acordes",
                        unit: 2,
                        tasks: [
                            { type: 'video', title: "Construcción de Acordes", videoId: "Y2MokfVUSqs", iconClass: 'ri-play-circle-line', instructions: "Descubre cómo se construyen los acordes a partir de intervalos apilados.", tip: "Un acorde es simplemente tres o más notas tocadas simultáneamente. Comienza identificando la nota base.", objective: ["Comprender la estructura de los acordes", "Identificar las notas que forman un acorde", "Preparar las manos para tocar acordes"] },
                            { type: 'video', title: "Acorde C y G7", videoId: "n7qaCP5a-Pc", iconClass: 'ri-play-circle-line', instructions: "Aprende a formar y tocar los acordes de Do mayor y Sol séptima, fundamentales en muchas piezas.", tip: "Memoriza la forma de estos acordes. Son los más usados en música para principiantes.", objective: ["Dominar los acordes de C y G7", "Cambiar entre acordes suavemente", "Comprender su función armónica"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1UtQsQYtjkYxqbVnCGfTmNa85xtnhG3W7/preview", iconClass: 'ri-todo-line', instructions: "Practica cambios de acordes y patrones de acompañamiento con estos ejercicios.", tip: "Mantén los dedos curvados y toca todas las notas del acorde al mismo tiempo.", objective: ["Ejecutar acordes con claridad", "Desarrollar fuerza en los dedos", "Practicar transiciones entre acordes"] },
                            { type: 'exercise', title: "Trumpet Voluntary", contentUrl: "https://www.mozart-app.com/xml2?file=Trumpet Voluntary.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta esta pieza clásica que incorpora los acordes que has aprendido.", tip: "La mano derecha lleva la melodía principal. Asegúrate de que suene más fuerte que los acordes.", objective: ["Combinar melodía y acordes en una interpretación", "Aplicar balance dinámico", "Ejecutar una pieza de repertorio clásico"] }
                        ]
                    },
                    {
                        title: "Lección 7: Corcheas y Staccato",
                        unit: 2,
                        tasks: [
                            { type: 'video', title: "Corcheas", videoId: "LJIBynkI1Cs", iconClass: 'ri-play-circle-line', instructions: "Aprende a tocar corcheas, las notas que duran la mitad de un tiempo.", tip: "Las corcheas se cuentan '1-y-2-y-3-y-4-y'. Practica contando en voz alta.", objective: ["Comprender el valor rítmico de las corcheas", "Tocar ritmos con corcheas", "Mantener pulso constante en ritmos más rápidos"] },
                            { type: 'video', title: "Staccato", videoId: "5zX6CFXf6cQ", iconClass: 'ri-play-circle-line', instructions: "Descubre el staccato, una técnica que crea notas cortas y separadas.", tip: "Staccato significa 'picado'. Imagina que tocas una estufa caliente - rápido y ligero.", objective: ["Ejecutar la articulación staccato correctamente", "Distinguir entre legato y staccato", "Añadir variedad expresiva a tu interpretación"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1DquyL0GuDR3zojHcmzBLPZaA598DMLbu/preview", iconClass: 'ri-todo-line', instructions: "Practica corcheas y staccato con estos ejercicios diseñados específicamente para estas técnicas.", tip: "Alterna entre tocar legato y staccato para sentir la diferencia en tu cuerpo.", objective: ["Dominar ritmos con corcheas", "Perfeccionar la técnica staccato", "Combinar diferentes articulaciones"] },
                            { type: 'exercise', title: "Old German Dance", contentUrl: "https://www.mozart-app.com/xml2?file=old-german-dance-michael-praetorius.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta esta danza alemana que utiliza corcheas y staccato para crear un carácter alegre.", tip: "Esta pieza debe sonar juguetona y ligera. Deja que tu muñeca esté relajada.", objective: ["Aplicar corcheas en contexto musical", "Usar staccato expresivamente", "Interpretar música del periodo renacentista"] }
                        ]
                    },
                    {
                        title: "Lección 8: Posición de Do",
                        unit: 3,
                        tasks: [
                            { type: 'video', title: "Posición de Do II", videoId: "KopYT505jHA", iconClass: 'ri-play-circle-line', instructions: "Expande tu conocimiento de la posición de Do explorando diferentes octavas y variaciones.", tip: "La posición de Do puede empezar en diferentes lugares del teclado. El patrón es siempre el mismo.", objective: ["Reconocer la posición de Do en diferentes octavas", "Trasladar posiciones fluidamente", "Ampliar tu rango en el teclado"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1uuu7dX6SRoOIi1aqzTEJ1xj8CbfW6Uft/preview", iconClass: 'ri-todo-line', instructions: "Trabaja estos ejercicios que te llevan por diferentes posiciones de Do en el teclado.", tip: "Mantén la forma de la mano constante cuando cambies de posición.", objective: ["Practicar cambios de posición", "Desarrollar orientación en el teclado", "Fortalecer técnica en múltiples registros"] },
                            { type: 'video', title: "Marcas de Tempo y Dinámicas", videoId: "fOHFGsq-cGw", iconClass: 'ri-play-circle-line', instructions: "Aprende a interpretar las indicaciones de velocidad y volumen en las partituras.", tip: "Términos como 'forte' (fuerte) y 'piano' (suave) son en italiano. Son universales en la música.", objective: ["Comprender términos de tempo comunes", "Reconocer símbolos dinámicos", "Aplicar variaciones de velocidad y volumen"] },
                            { type: 'exercise', title: "Waltz", contentUrl: "https://www.mozart-app.com/xml2?file=waltz-carl-czerny.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta este vals aplicando todas las indicaciones de tempo y dinámicas.", tip: "Un vals tiene ritmo de 3/4. El primer tiempo debe sentirse más fuerte que el 2 y 3.", objective: ["Ejecutar un vals con estilo apropiado", "Aplicar indicaciones de interpretación", "Desarrollar sensibilidad musical avanzada"] }
                        ]
                    },
                    {
                        title: "Lección 9: Posición de Sol",
                        unit: 3,
                        tasks: [
                            { type: 'video', title: "Posición de Sol", videoId: "jGM_qOcewYg", iconClass: 'ri-play-circle-line', instructions: "Aprende una nueva posición fundamental: la posición de Sol, que expande tus posibilidades melódicas.", tip: "En posición de Sol, tu pulgar derecho empieza en la nota Sol. Encuentra todas las teclas Sol primero.", objective: ["Dominar la posición de Sol", "Comparar con la posición de Do", "Tocar en nuevas tonalidades"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/1CfqcsxDsyCwxo8ZhhOrejiiJcgyEzxCE/preview", iconClass: 'ri-todo-line', instructions: "Practica estos ejercicios específicos para familiarizarte con la posición de Sol.", tip: "Compara la sensación de esta posición con la de Do. Nota las similitudes y diferencias.", objective: ["Establecer memoria muscular en posición de Sol", "Practicar digitación correcta", "Ganar confianza en la nueva posición"] },
                            { type: 'exercise', title: "Bagpipe", contentUrl: "https://drive.google.com/file/d/16hYD36HcMS-WRqzR9pBvSLHCxifOTkWc/preview", iconClass: 'ri-file-music-line', instructions: "Toca esta pieza que imita el sonido de la gaita, usando la posición de Sol.", tip: "Las gaitas tienen un sonido constante y mantenido. Toca con articulación suave y fluida.", objective: ["Aplicar posición de Sol en repertorio", "Crear carácter específico en la interpretación", "Desarrollar control de sonido sostenido"] }
                        ]
                    },
                    {
                        title: "Lección 10: Ligaduras",
                        unit: 3,
                        tasks: [
                            { type: 'video', title: "Ligadura de prolongación", videoId: "edjG-czdX2Y", iconClass: 'ri-play-circle-line', instructions: "Descubre cómo las ligaduras conectan notas para extender su duración.", tip: "Una ligadura une dos notas de la misma altura. Solo tocas la primera, pero mantienes el sonido.", objective: ["Comprender el concepto de ligadura", "Identificar ligaduras en partituras", "Ejecutar ritmos sincopados correctamente"] },
                            { type: 'exercise', title: "Ejercicios", contentUrl: "https://drive.google.com/file/d/16dc7Bkc7KtoP95hA1Tcni_i4M7eDfNLf/preview", iconClass: 'ri-todo-line', instructions: "Practica con ejercicios que incluyen ligaduras en diferentes contextos rítmicos.", tip: "Cuenta en voz alta y mantén el dedo presionado durante toda la duración combinada.", objective: ["Ejecutar ligaduras correctamente", "Desarrollar precisión rítmica avanzada", "Mantener pulso constante con ritmos complejos"] },
                            { type: 'exercise', title: "Sonatina", contentUrl: "https://www.mozart-app.com/xml2?file=sonatina.musicxml", iconClass: 'ri-file-music-line', instructions: "Interpreta esta sonatina que incorpora todas las técnicas aprendidas, incluyendo ligaduras.", tip: "Una sonatina es una 'pequeña sonata'. Tócala con elegancia y atención al detalle.", objective: ["Integrar todas las técnicas aprendidas", "Interpretar una pieza de forma musical completa", "Demostrar progreso técnico y musical"] }
                        ]
                    }
                ]
            },
           { 
  id: 1, 
  title: 'Nivel 1', 
  image: 'https://lh3.googleusercontent.com/d/1-N9cbc8C7xiHKUbUnZdE3FviJCjbVa_r=s600', 
  progress: 0, 
  description: 'Domina la posición de Sol, alteraciones, armaduras y síncopas a través de un repertorio clásico progresivo.', 
  duration: '10 Lecciones', 
  lessons: [
    // --- BLOQUE 1 (Unidad 1) ---
    { 
      title: "Lección 1: Posición de Sol (2da parte)", 
      unit: 1, 
      tasks: [
        { type: 'video', title: "Solfeo I: Descripción", videoId: "sn9AnIwXWNw", iconClass: 'ri-play-circle-line', instructions: "Introducción al solfeo en posición de Sol." },
        { type: 'exercise', title: "Ejercicios de Solfeo", contentUrl: "https://drive.google.com/file/d/1rnUC_AB2buvh-BLf16L6SOte4ct2y4bx/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Posición de Sol: Lección", videoId: "gtkAYv5wBoA", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicio Práctico", contentUrl: "https://drive.google.com/file/d/1DRf5RdEG7C7KAVxv4wy593dfN8Cbeqat/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Minuet (Gurlitt) - Ejemplo", videoId: "ZHuYXBK1IM4", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Minuet", contentUrl: "https://drive.google.com/file/d/1-Gh5AJBcEaO1eVJ-SeV6-kTmlaPK5muP/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 2: Posición Combinada", 
      unit: 1, 
      tasks: [
        { type: 'video', title: "Solfeo II: Descripción", videoId: "-G5yINx85k0", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios de Solfeo", contentUrl: "https://drive.google.com/file/d/1upeZQGqvk9PFCBiyIVeONZK0E0P5f01l/preview", iconClass: 'ri-edit-line' },
        { type: 'exercise', title: "Ejercicio de Posición", contentUrl: "https://drive.google.com/file/d/1zU6zcWwIxgzR4iy0yL8N651kcarf2X9u/preview", iconClass: 'ri-file-text-line' },
        { type: 'exercise', title: "Ejercicio: Marcha", contentUrl: "https://drive.google.com/file/d/1gPwPtcEmfF-zBLaQLJBKwQOWYJTX_6cf/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Minuet (Reinagle) - Ejemplo", videoId: "Riv3gEBBG9I", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Minuet", contentUrl: "https://drive.google.com/file/d/1_v-xICqupk8KUO32-PwZKURNhRtXRjh6/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 3: Alteraciones", 
      unit: 1, 
      tasks: [
        { type: 'exercise', title: "Solfeo III: Ejercicios", contentUrl: "https://drive.google.com/file/d/10LdRbiKINHgPs3QgcZf_9Ts2WsCzvw3p/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "El Sostenido: Explicación", videoId: "0tyWeauOFzQ", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicio: Sostenidos", contentUrl: "https://drive.google.com/file/d/1azmdnqr2BWqj3NiWWCg-Fl0-DBcDA6II/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "La Armadura: Lección", videoId: "6iR3f8m8COM", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: La Armadura", contentUrl: "https://drive.google.com/file/d/1kr9ChyBTuFpBXg_obh62-AG3q_MRfb5q/preview", iconClass: 'ri-book-read-line' },
        { type: 'video', title: "Pieza: Promenade - Ejemplo", videoId: "aOFeOBDlWDA", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Promenade", contentUrl: "https://drive.google.com/file/d/140Aklx2WntuhqRCxChRcpKDs06soKJfA/preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- BLOQUE 2 (Unidad 2) ---
    { 
      title: "Lección 4: Cambio de Posición", 
      unit: 2, 
      tasks: [
        { type: 'exercise', title: "Solfeo IV: Ejercicios", contentUrl: "https://drive.google.com/file/d/1nbWUe2RCjSORXae8hCxr5U-bqy9PuOtc/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Cambio de Posición: Definición", videoId: "oBRoDA-GkBQ", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios Prácticos", contentUrl: "https://drive.google.com/file/d/1K_lWzEDpurCRuhJiYdCZ1rPliCSURyFe/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Dance - Ejemplo", videoId: "CcQlCKt1MgM", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Dance", contentUrl: "https://drive.google.com/file/d/1HT2Ih91glXfWEC0A6uM4KSXZc_whfsku/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 5: Intervalos de 6ta", 
      unit: 2, 
      tasks: [
        { type: 'exercise', title: "Solfeo V: Ejercicios", contentUrl: "https://drive.google.com/file/d/1aqzF5rbWmzVnnOlqOjsjwLmzZGU1VpUY/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Intervalos de 6ta: Lección", videoId: "SEAdyQ0Zw3M", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: Intervalos", contentUrl: "https://drive.google.com/file/d/18uL7_4_fhiE1n8zYyLrW_xZhCsSpYzTE/preview", iconClass: 'ri-book-read-line' },
        { type: 'exercise', title: "Ejercicios de 6tas", contentUrl: "https://drive.google.com/file/d/1N8HAVRAWFxKlmniv5Bd0jIGPl9GmD38k/preview", iconClass: 'ri-file-text-line' },
        { type: 'exercise', title: "DC al Fine: Ejercicios", contentUrl: "https://drive.google.com/file/d/1G8EbF6t3wgrdSgpZVAmTv6OFhI31m8XW/preview", iconClass: 'ri-refresh-line' },
        { type: 'video', title: "Pieza: Sonatina (Gurlitt)", videoId: "n-CJ6AP83zs", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Sonatina", contentUrl: "https://drive.google.com/file/d/1F7mj27XUDWz6-8R6adN6f6vLUnJAEOio/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 6: Posición de Fa", 
      unit: 2, 
      tasks: [
        { type: 'exercise', title: "Solfeo VI: Ejercicios", contentUrl: "https://drive.google.com/file/d/144ZOFA87KNajpViMk4T53YnSzMhWGZQy/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "El Bemol: Explicación", videoId: "aLNz-5bsWb8", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: El Bemol", contentUrl: "https://drive.google.com/file/d/1_UXn8vUzyImBDGlY_Q9RFZOT703Nfngq/preview", iconClass: 'ri-book-read-line' },
        { type: 'video', title: "Posición de Fa: Lección", videoId: "c1WwjyH2h3A", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Marcha en Fa", contentUrl: "https://drive.google.com/file/d/1pf-AuPRZDOYyu5Bjk10Gqf0KH4G2y7i8/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: The Old Windmill", videoId: "P64xNcu4v-w", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: The Old Windmill", contentUrl: "https://drive.google.com/file/d/1Yf667gGJI9QBfA0xMqvAiiyKUhF-HvaZ/preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- BLOQUE 3 (Unidad 3) ---
    { 
      title: "Lección 7: Escalas de C, G y F", 
      unit: 3, 
      tasks: [
        { type: 'exercise', title: "Ejercicios de Escalas", contentUrl: "https://drive.google.com/file/d/1unPI5MyC-yxZCXlaUDM375iHb9DbaOyN/preview", iconClass: 'ri-file-list-line' },
        { type: 'video', title: "Pieza: First Etude", videoId: "2OEzXuEbsA0", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: First Etude", contentUrl: "https://drive.google.com/file/d/1V1Ofj99nBsVR99fJ8m2oWcuTDx33sJtz/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 8: Más Notación Musical", 
      unit: 3, 
      tasks: [
        { type: 'video', title: "8va y Becuadro", videoId: "blGuL_tXviE", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios de Notación", contentUrl: "https://drive.google.com/file/d/1ZKfYtbA2LJmQOvZLpqJrfaZiLwyqKq7I/preview", iconClass: 'ri-file-edit-line' },
        { type: 'video', title: "Pieza: Jinx", videoId: "Z9QbuWRh7Bc", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Jinx", contentUrl: "https://drive.google.com/file/d/1VjDu6n4rO1HkIGWnnfh_0D7VRC9KWUW0/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 9: Síncopas", 
      unit: 3, 
      tasks: [
        { type: 'video', title: "Síncopas: Definición", videoId: "drI00sPPRks", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: Síncopas", contentUrl: "https://drive.google.com/file/d/1Go9CgkCirvErqeLn8QC1lF2tK69eZdSx/preview", iconClass: 'ri-book-read-line' },
        { type: 'exercise', title: "Ejercicios Rítmicos", contentUrl: "https://drive.google.com/file/d/14Aji9kUWssBCcBKU_zSCRkuK3sBwEVf7/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Minuet and Trío", videoId: "jdCm8wj-h0w", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Minuet and Trío", contentUrl: "https://drive.google.com/file/d/1W41ayDydPUrKU57OMHEfMl1BuzNYkk01/preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- PIEZA FINAL (Unidad 4 / Final) ---
    { 
      title: "Lección 10: Elección de Pieza Final", 
      unit: "Final", 
      tasks: [
        { type: 'video', title: "Repertorio: Lista A", videoId: "playlist?list=PLFLLmJ16LJSyilSL5i2UoEEiHaioZTVaW", iconClass: 'ri-play-list-line', instructions: "Escucha la lista y selecciona tu pieza favorita para el examen final." },
        { type: 'video', title: "Repertorio: Lista B", videoId: "playlist?list=PLFLLmJ16LJSy1cuiGt1xCqne4nQasdXMw", iconClass: 'ri-play-list-line' }
      ]
    }
  ]
},
           { 
  id: 2, 
  title: 'Nivel 2', 
  image: 'https://lh3.googleusercontent.com/d/1rlsS_7QEkC006srcfmgpTw_v4wqJdSSh=s500', 
  progress: 0, 
  description: 'Profundiza en la técnica pianística con contrapunto, estudio de triadas, inversiones, arpegios y métricas compuestas.', 
  duration: '10 Lecciones', 
  lessons: [
    // --- BLOQUE 1 (Unidad 1) ---
    { 
      title: "Lección 1: Cambio de Posición II", 
      unit: 1, 
      tasks: [
        { type: 'video', title: "Solfeo VII: Descripción", videoId: "V_qtDfHCdZw", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios de Solfeo", contentUrl: "https://drive.google.com/file/d/1jztdXACdUwHJZMOcsHjY4xLjsRiM7KLS/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Cambio de Posición II: Definición", videoId: "WvgG1n8njqw", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios Prácticos", contentUrl: "https://drive.google.com/file/d/1LCg9EBt1tBT4UUmH48xC_XTu64fPBKhu/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Allemande - Ejemplo", videoId: "BS1YWNFT98o", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Allemande", contentUrl: "https://drive.google.com/file/d/1ArvTOodKca-OExVvFaQnMYw3aj71mizc/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 2: Contrapunto", 
      unit: 1, 
      tasks: [
        { type: 'exercise', title: "Solfeo VIII: Ejercicios", contentUrl: "https://drive.google.com/file/d/1pzrUzz5p6mDfLPsaguhiNCJ_9hIf0M5D/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Contrapunto: Definición", videoId: "SWEK7J_8_Mw", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios de Contrapunto", contentUrl: "https://drive.google.com/file/d/14SKHXbiMeQ4AYWk9QtF3wIp3E0qPdPEa/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Andante (Beyer)", videoId: "fLfVLRUuH_0", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Andante", contentUrl: "https://drive.google.com/file/d/1_HyfX-I55m7Rhwas2sOvY1SwGRCST4JH/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 3: Intervalos de 7ma y 8va", 
      unit: 1, 
      tasks: [
        { type: 'exercise', title: "Solfeo IX: Ejercicios", contentUrl: "https://drive.google.com/file/d/1IICpRij9qfT1LC3SOgy2-hNhU3qducu3/preview", iconClass: 'ri-edit-line' },
        { type: 'video', title: "Intervalos: Lección", videoId: "cOFpHDlol2Y", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: 7ma y 8va", contentUrl: "https://drive.google.com/file/d/1Al9fBtgZOAlyB4aGGAGwajwrWggzJ6qy/preview", iconClass: 'ri-book-read-line' },
        { type: 'video', title: "Pieza: Minuet (Leopold Mozart)", videoId: "OLtap24RWpg", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Minuet", contentUrl: "https://drive.google.com/file/d/1wEngXDEnzxCH-nUdvqpyP9TJl2LT7Z0X/preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- BLOQUE 2 (Unidad 2) ---
    { 
      title: "Lección 4: Grados de escalas", 
      unit: 2, 
      tasks: [
        { type: 'video', title: "Grados: Definición", videoId: "v1e-4OnBlI0", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: Grados", contentUrl: "https://drive.google.com/file/d/1KC_u0nOi-PjotEKLGuEAPDXiDEJvDUwA/preview", iconClass: 'ri-book-read-line' },
        { type: 'video', title: "Pieza: Aria in F", videoId: "NIYHDXfB9UQ", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Aria in F", contentUrl: "https://drive.google.com/file/d/1WhaTn70R8qil68wjWdMAmLfa6Ij77dzC/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 5: Triadas", 
      unit: 2, 
      tasks: [
        { type: 'video', title: "Triadas: Definición y Tipos", videoId: "35sho6430Zo", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: Triadas", contentUrl: "https://drive.google.com/file/d/1ZsapPWehg_8NLCydckeLOCLDuCrioAFw/preview", iconClass: 'ri-book-read-line' },
        { type: 'exercise', title: "Ejercicio: Triadas Mayores/Menores", contentUrl: "https://drive.google.com/file/d/1afrrOkeHBa_FPYagQsRgcpWEaBkwvVF7/preview", iconClass: 'ri-file-text-line' },
        { type: 'exercise', title: "Ejercicios Adicionales", contentUrl: "https://drive.google.com/file/d/1TwDvzf9bdN5jEYBWRgA9BbZbjDd7buev/preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Galope (Kabalevsky)", videoId: "FoSBgcMH6QQ", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Galope", contentUrl: "https://drive.google.com/file/d/1dosurupTiVPzuNpM29V2tn3HDcSd1BS2/preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 6: Inversión de triadas", 
      unit: 2, 
      tasks: [
        { type: 'video', title: "Escalas: Lección", videoId: "", iconClass: 'ri-play-circle-line', instructions: "Video pendiente de asignar" },
        { type: 'pdf', title: "Grupo 1: Escalas", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-list-line' },
        { type: 'pdf', title: "Grupo 2: Escalas", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-list-line' },
        { type: 'video', title: "Pieza: Waltz (Kabalevsky)", videoId: "", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Waltz", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- BLOQUE 3 (Unidad 3) ---
    { 
      title: "Lección 7: Arpegios", 
      unit: 3, 
      tasks: [
        { type: 'video', title: "Arpegios: Definición", videoId: "", iconClass: 'ri-play-circle-line' },
        { type: 'pdf', title: "Teoría: Arpegios", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-book-read-line' },
        { type: 'exercise', title: "Ejercicios de Arpegios", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Melody (Kohler)", videoId: "", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Melody", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 8: Tresillos", 
      unit: 3, 
      tasks: [
        { type: 'video', title: "Tresillos: Lección", videoId: "", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios de Tresillos", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Ejemplo", videoId: "", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Pieza por definir", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-music-line' }
      ]
    },
    { 
      title: "Lección 9: Métricas compuestas", 
      unit: 3, 
      tasks: [
        { type: 'video', title: "Métricas Compuestas: Definición", videoId: "", iconClass: 'ri-play-circle-line' },
        { type: 'exercise', title: "Ejercicios Métricos", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-text-line' },
        { type: 'video', title: "Pieza: Melody (Le Couppey)", videoId: "", iconClass: 'ri-music-2-line' },
        { type: 'pdf', title: "Partitura: Melody", contentUrl: "https://drive.google.com/file/d//preview", iconClass: 'ri-file-music-line' }
      ]
    },

    // --- PIEZA FINAL (Unidad 4 / Final) ---
    { 
      title: "Lección 10: Elección de Pieza Final", 
      unit: "Final", 
      tasks: [
        { type: 'video', title: "Repertorio: Lista A", videoId: "playlist?list=PLFLLmJ16LJSyilSL5i2UoEEiHaioZTVaW", iconClass: 'ri-play-list-line', instructions: "Selecciona tu pieza favorita de la Lista A." },
        { type: 'video', title: "Repertorio: Lista B", videoId: "playlist?list=PLFLLmJ16LJSy1cuiGt1xCqne4nQasdXMw", iconClass: 'ri-play-list-line', instructions: "Selecciona tu pieza favorita de la Lista B." }
      ]
    }
  ]
},
            { id: 3, title: 'Nivel 3', image: 'https://lh3.googleusercontent.com/d/1B3bJ8kUrGHqZNC04F3ghQ5j9HhUWCOqv=s500', progress: 0, description: 'Domina técnicas profesionales y repertorio clásico.', duration: '8 horas', lessons: [{ title: "Lección 1: Técnica Avanzada", unit: 1, tasks: [] }] },
            { id: 4, title: 'Nivel 4', image: 'https://lh3.googleusercontent.com/d/1k7e90HOxUnPKK_Qu9V0cS-WSCY7rKMTM=s500', progress: 0, description: 'Perfecciona tu interpretación y expresión musical.', duration: '10 horas', lessons: [{ title: "Lección 1: Interpretación", unit: 1, tasks: [] }] },
            { id: 5, title: 'Nivel 5', image: 'https://lh3.googleusercontent.com/d/1LjeOioZoUI_NEzb3p7NfA2hlrPwx__TN=s500', progress: 0, description: 'Nivel maestro: repertorio complejo y composición.', duration: '12 horas', lessons: [{ title: "Lección 1: Composición", unit: 1, tasks: [] }] }
        ]);
        
        // ==========================================
        // SECCIÓN 2: VARIABLES NO REACTIVAS (YouTube)
        // ==========================================
        let youtubePlayer = null;
        let videoHasEnded = false;
        let pauseTimer = null;
        let isYouTubeAPIReady = false;
        let shouldAutoplayVideo = false;
        
        
        // ==========================================
        // SECCIÓN 3: FUNCIONES DE API Y DATOS
        // ==========================================
        
        const fetchUserData = async () => {
            const requestData = {
                action: "getUserData",
                token: localStorage.getItem('MStoken')
            };

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', {
                    method: 'POST',
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify(requestData)
                });
                const data = await response.json();
                const stage = JSON.parse(data.stage);
                
                serverLevelIndex.value = stage.lvl;
                serverLessonIndex.value = stage.lsn;
                currentLevelIndex.value = stage.lvl;
                
                levels.value.forEach(level => {
                    if (level.id < currentLevelIndex.value) {
                        level.progress = 100;
                    } else if (level.id > currentLevelIndex.value) {
                        level.progress = 0;
                    }
                });
                
                initApp(serverLevelIndex.value, serverLessonIndex.value);
            } catch (error) {
                console.error('Error fetching user data:', error);
                serverLevelIndex.value = 0;
                serverLessonIndex.value = 0;
                currentLevelIndex.value = 0;
                levels.value.forEach(level => { level.progress = 0; });
                initApp(0, 0);
            } finally {
                isLoading.value = false;
            }
        };
        
        
        // ==========================================
        // SECCIÓN 4: INICIALIZACIÓN DE LA APP
        // ==========================================
        
        const initApp = (startLevelIdx, startLessonIdx, autoLoad = true) => {
            if (!levels.value[startLevelIdx]) {
                console.error("El nivel " + startLevelIdx + " no existe. Empezando en 0.");
                startLevelIdx = 0;
                startLessonIdx = 0;
            }

            selectedLevel.value = levels.value[startLevelIdx];

            // Marcar niveles inferiores como completados
            levels.value.forEach((level, idx) => {
                if (idx < startLevelIdx) {
                    if (!savedProgress.value[level.id]) {
                        const completedLessons = JSON.parse(JSON.stringify(level.lessons));
                        completedLessons.forEach(lesson => {
                            lesson.completed = true;
                            lesson.expanded = false;
                            lesson.tasks.forEach(task => { task.completed = true; });
                        });
                        
                        savedProgress.value[level.id] = {
                            lessons: completedLessons,
                            currentLessonIndex: completedLessons.length,
                            currentTaskIndex: 0,
                            totalTasksCompleted: completedLessons.reduce((acc, l) => acc + l.tasks.length, 0),
                            progress: 100
                        };
                    }
                    level.progress = 100;
                }
            });

            // Restaurar progreso guardado o iniciar nuevo
            if (savedProgress.value[selectedLevel.value.id]) {
                const saved = savedProgress.value[selectedLevel.value.id];
                lessons.value = JSON.parse(JSON.stringify(saved.lessons));
                currentLessonIndex.value = saved.currentLessonIndex;
                currentTaskIndex.value = saved.currentTaskIndex;
                totalTasksCompleted.value = saved.totalTasksCompleted;
                progress.value = saved.progress;
                totalTasks.value = lessons.value.reduce((acc, lesson) => acc + lesson.tasks.length, 0);
                
                updatePendingTasks();
                if (autoLoad) loadCurrentTask();
            } else {
                lessons.value = JSON.parse(JSON.stringify(selectedLevel.value.lessons));
                totalTasks.value = lessons.value.reduce((acc, lesson) => acc + lesson.tasks.length, 0);
                totalTasksCompleted.value = 0;

                lessons.value.forEach((lesson, l_idx) => {
                    if (l_idx < startLessonIdx) {
                        lesson.completed = true;
                        lesson.expanded = false;
                        lesson.tasks.forEach(task => {
                            task.completed = true;
                            totalTasksCompleted.value++;
                        });
                    } else if (l_idx === startLessonIdx) {
                        lesson.completed = false;
                        lesson.expanded = true;
                        lesson.tasks.forEach(task => { task.completed = false; });
                    } else {
                        lesson.completed = false;
                        lesson.expanded = false;
                        lesson.tasks.forEach(task => task.completed = false);
                    }
                });
                
                currentLessonIndex.value = startLessonIdx;
                currentTaskIndex.value = 0;
                updateProgress();
                updatePendingTasks();
                if (autoLoad) loadCurrentTask();
            }
            selectedLevel.value.progress = progress.value;
        };
        
        
        // ==========================================
        // SECCIÓN 5: NAVEGACIÓN ENTRE VISTAS
        // ==========================================
        
        const selectLevel = (level) => {
            if (currentLevelIndex.value >= level.id) {
                selectedLevel.value = level;
                startApp();
            }
        };

        const startApp = () => {
            if (!selectedLevel.value) return;
            const levelToLoad = selectedLevel.value.id;
            let lessonToLoad = 0;
            if (levelToLoad === serverLevelIndex.value) {
                lessonToLoad = serverLessonIndex.value;
            }
            currentView.value = 'app';
            initApp(levelToLoad, lessonToLoad);
        };

        const showLevelSelector = () => {
            if (selectedLevel.value) {
                savedProgress.value[selectedLevel.value.id] = {
                    lessons: JSON.parse(JSON.stringify(lessons.value)),
                    currentLessonIndex: currentLessonIndex.value,
                    currentTaskIndex: currentTaskIndex.value,
                    totalTasksCompleted: totalTasksCompleted.value,
                    progress: progress.value
                };
                selectedLevel.value.progress = progress.value;
                
                if (currentLessonIndex.value >= lessons.value.length) {
                    currentLevelIndex.value = Math.max(currentLevelIndex.value, selectedLevel.value.id + 1);
                }
            }
            
            levels.value.forEach(level => {
                if (savedProgress.value[level.id]) {
                    level.progress = savedProgress.value[level.id].progress;
                }
            });
            
            currentView.value = 'levelSelector';
        };

        const toggleSidebar = () => { 
            sidebarOpen.value = !sidebarOpen.value; 
        };

        const toggleLesson = (lesson, lessonIndex) => {
            lesson.expanded = !lesson.expanded;
        };



        const prevTaskInfo = computed(() => {
    // Usamos viewingLessonIndex/TaskIndex para saber qué se está viendo, no necesariamente el progreso actual
    let lIdx = viewingLessonIndex.value;
    let tIdx = viewingTaskIndex.value;

    // Si hay una tarea anterior en la misma lección
    if (tIdx > 0) {
        return { 
            title: lessons.value[lIdx].tasks[tIdx - 1].title, 
            lIdx: lIdx, 
            tIdx: tIdx - 1 
        };
    } 
    // Si no, buscamos la última tarea de la lección anterior
    else if (lIdx > 0) {
        const prevLesson = lessons.value[lIdx - 1];
        const lastTaskIdx = prevLesson.tasks.length - 1;
        return { 
            title: prevLesson.tasks[lastTaskIdx].title, 
            lIdx: lIdx - 1, 
            tIdx: lastTaskIdx 
        };
    }
    return null; // No hay nada atrás
});

        const nextTaskInfo = computed(() => {
    let lIdx = viewingLessonIndex.value;
    let tIdx = viewingTaskIndex.value;
    const currentLesson = lessons.value[lIdx];

    // 1. Calcular cuál es la SIGUIENTE tarea física
    let nextL = lIdx;
    let nextT = tIdx;

    if (tIdx < currentLesson.tasks.length - 1) {
        nextT++;
    } else if (lIdx < lessons.value.length - 1) {
        nextL++;
        nextT = 0;
    } else {
        return null; // No hay más contenido (Fin del curso)
    }


    const isAtFrontier = (lIdx === currentLessonIndex.value) && (tIdx === currentTaskIndex.value);
    const currentTask = currentLesson.tasks[tIdx];
    
    // Si estamos en el límite, es video y no está completo => BLOQUEADO
    const isLocked = isAtFrontier && (currentTask.type === 'video' && !currentTask.completed);

    return {
        title: lessons.value[nextL].tasks[nextT].title,
        lIdx: nextL,
        tIdx: nextT,
        locked: isLocked
    };
});


const handleNext = () => {
    const next = nextTaskInfo.value;
    if (!next || next.locked) return;
    const isAtFrontier = (viewingLessonIndex.value === currentLessonIndex.value) && 
                         (viewingTaskIndex.value === currentTaskIndex.value);
    
    const currentTask = lessons.value[viewingLessonIndex.value].tasks[viewingTaskIndex.value];
    if (isAtFrontier && currentTask.type !== 'video') {
        completeCurrentTask(); 
    } else {
        viewTask(next.lIdx, next.tIdx);
    }
};

  const saveUserProgress = async () => {
    if (!selectedLevel.value) return;

    // Obtenemos los valores ACTUALES (ya actualizados)
    const payload = {
        action: "saveProgress",
        token: localStorage.getItem('MStoken'),
        stage: JSON.stringify({
            lvl: currentLevelIndex.value,
            lsn: currentLessonIndex.value,
            act: currentTaskIndex.value // <--- CAMBIO: Usamos 'act' directamente
        })
    };

    console.log("Guardando estado:", payload.stage); // Debug para ver qué se envía

    try {
        fetch('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', {
            method: 'POST',
            mode: 'no-cors', 
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(payload)
        });
    } catch (e) {
        console.error("Error guardando progreso", e);
    }
};


/*
const nextTaskInfo = computed(() => {
    let lIdx = viewingLessonIndex.value;
    let tIdx = viewingTaskIndex.value;
    const currentLesson = lessons.value[lIdx];

    let nextL = lIdx;
    let nextT = tIdx;

    // Calcular índices del siguiente
    if (tIdx < currentLesson.tasks.length - 1) {
        nextT++;
    } else if (lIdx < lessons.value.length - 1) {
        nextL++;
        nextT = 0;
    } else {
        return null; // No hay nada adelante (fin del curso)
    }

    // Verificar si está bloqueado (comparando con el progreso real del usuario)
    const isLocked = (nextL > currentLessonIndex.value) || 
                     (nextL === currentLessonIndex.value && nextT > currentTaskIndex.value);

    return {
        title: lessons.value[nextL].tasks[nextT].title,
        lIdx: nextL,
        tIdx: nextT,
        locked: isLocked
    };
});
 */       
        
        // ==========================================
        // SECCIÓN 6: GESTIÓN DE TAREAS
        // ==========================================
        
        const viewTask = (lessonIndex, taskIndex) => {
            const isFutureTask = (lessonIndex > currentLessonIndex.value) || 
                                 (lessonIndex === currentLessonIndex.value && taskIndex > currentTaskIndex.value);

            if (isFutureTask) {
                console.log("Tarea bloqueada. Completa la actual primero.");
                return;
            }

            viewingLessonIndex.value = lessonIndex;
            viewingTaskIndex.value = taskIndex;
            
            const task = lessons.value[lessonIndex].tasks[taskIndex];
            currentViewingTask.value = task;
            const youtubeContainer = document.getElementById('youtube-container');
            const contentIframe = document.getElementById('content-iframe');

            if (task.type === 'video') {
                showingVideo.value = true;
                contentIframe.style.display = 'none';
                youtubeContainer.style.display = 'block';
                openVideoModal(task);
            } else {
                showingVideo.value = false;
                youtubeContainer.style.display = 'none';
                contentIframe.style.display = 'block';
                currentTaskUrl.value = task.contentUrl;
            }
            
            if (sidebarOpen.value) {
                setTimeout(() => { sidebarOpen.value = false; }, 200);
            }
        };

        const loadCurrentTask = () => {
            if (currentLessonIndex.value >= lessons.value.length) {
                currentLessonIndex.value = lessons.value.length - 1;
                currentTaskIndex.value = lessons.value[currentLessonIndex.value].tasks.length - 1;
                
                const lesson = lessons.value[currentLessonIndex.value];
                const task = lesson.tasks[currentTaskIndex.value];
                
                currentViewingTask.value = task;
                lesson.expanded = true;
                viewingLessonIndex.value = currentLessonIndex.value;
                viewingTaskIndex.value = currentTaskIndex.value;
                
                if (task.type === 'video') {
                    openVideoModal(task);
                } else {
                    showingVideo.value = false;
                    document.getElementById('youtube-container').style.display = 'none';
                    document.getElementById('content-iframe').style.display = 'block';
                    currentTaskUrl.value = task.contentUrl;
                }
                return;
            }
            
            const lesson = lessons.value[currentLessonIndex.value];
            const task = lesson.tasks[currentTaskIndex.value];
            
            currentViewingTask.value = task;
            lesson.expanded = true;
            viewingLessonIndex.value = currentLessonIndex.value;
            viewingTaskIndex.value = currentTaskIndex.value;
            
            if (task.type === 'video') {
                speak(`Siguiente: ${task.title}.`);
                openVideoModal(task);
            } else {
                currentTaskUrl.value = task.contentUrl;
                if (task.type === 'note') {
                    speak(`Ahora, ${task.title}`, 'important');
                } else {
                    speak(`Siguiente: ${task.title}. Haz clic en el ícono para comenzar.`);
                }
            }
            
            if (sidebarOpen.value) {
                setTimeout(() => { sidebarOpen.value = false; }, 200);
            }
        };

const completeCurrentTask = () => {
    const lesson = lessons.value[currentLessonIndex.value];
    const task = lesson.tasks[currentTaskIndex.value];

    if (!task.completed) {
        task.completed = true;
        totalTasksCompleted.value++;
        updateProgress();
        updatePendingTasks();
    }
    let nextTaskIdx = currentTaskIndex.value + 1;
    let nextLessonIdx = currentLessonIndex.value;
    if (nextTaskIdx >= lesson.tasks.length) {
        completeLesson(); 
    } else {
        currentTaskIndex.value = nextTaskIdx;
        shouldAutoplayVideo = true;
        setTimeout(loadCurrentTask, 1200);
    }
    saveUserProgress(); 
};

        const completeLesson = () => {
            const lesson = lessons.value[currentLessonIndex.value];
            speak(`¡Felicidades! Has completado la ${lesson.title}.`, 'important');
            lesson.completed = true;
            showConfetti();
            
            currentLessonIndex.value++;
            currentTaskIndex.value = 0;

            if (currentLessonIndex.value >= lessons.value.length) {
                currentLevelIndex.value = Math.max(currentLevelIndex.value, selectedLevel.value.id + 1);
                speak("¡Has completado todo el nivel! El siguiente nivel ha sido desbloqueado.", 'important');
                showConfetti(200);
                
                setTimeout(() => {
                    alert("¡Nivel Completado! 🎉\n\nHas terminado todas las lecciones de este nivel.\nEl siguiente nivel ha sido desbloqueado.");
                    showLevelSelector();
                }, 1500);
                return;
            }
            shouldAutoplayVideo = true;
            setTimeout(loadCurrentTask, 1500);
        };
        
        
        // ==========================================
        // SECCIÓN 7: ACTUALIZACIÓN DE ESTADO
        // ==========================================
        
      // Busca esta función en tu código actual
const updateProgress = () => {
    if (totalTasks.value === 0) {
        progress.value = 0;
        return;
    }
    // Math.round() quita los decimales redondeando al entero más cercano
    progress.value = Math.round((totalTasksCompleted.value / totalTasks.value) * 100);
};

        const updatePendingTasks = () => {
            pendingTasks.value = [];
            
            if (currentLessonIndex.value < lessons.value.length) {
                const currentLesson = lessons.value[currentLessonIndex.value];
                const tasksToShow = currentLesson.tasks.slice(0, 3);
                
                tasksToShow.forEach((task, index) => {
                    pendingTasks.value.push({
                        lessonTitle: currentLesson.title,
                        taskTitle: task.title,
                        taskType: task.type,
                        lessonIndex: currentLessonIndex.value,
                        taskIndex: index,
                        iconClass: task.iconClass || getIconForTaskType(task.type),
                        completed: task.completed
                    });
                });
            }
        };

        const getIconForTaskType = (type) => {
            const icons = {
                'video': 'ri-play-circle-line',
                'exercise': 'ri-todo-line',
                'quiz': 'ri-question-line',
                'record': 'ri-mic-line',
                'note': 'ri-music-2-line'
            };
            return icons[type] || 'ri-file-line';
        };
        
        
        // ==========================================
        // SECCIÓN 8: YOUTUBE VIDEO
        // ==========================================
        
        const initYouTubePlayer = (videoId) => {
            videoHasEnded = false;
            youtubePlayer = new YT.Player('player', {
                width: '100%',
                height: '100%',
                videoId: videoId,
                playerVars: { 'playsinline': 1, 'rel': 0 },
                events: {
                    'onReady': (event) => {
                        if (shouldAutoplayVideo) event.target.playVideo();
                    },
                    'onStateChange': onPlayerStateChange
                }
            });
        };

        const onPlayerStateChange = (event) => {
            const pauseModal = document.getElementById('pauseModal');
            const finishedModal = document.getElementById('finishedModal');
            clearTimeout(pauseTimer);

            switch (event.data) {
                case YT.PlayerState.PLAYING:
                    pauseModal.style.display = 'none';
                    break;
                case YT.PlayerState.PAUSED:
                    if (!videoHasEnded) {
                        pauseTimer = setTimeout(() => {
                            if (youtubePlayer && youtubePlayer.getPlayerState() === YT.PlayerState.PAUSED) {
                                pauseModal.style.display = 'flex';
                            }
                        }, 250);
                    }
                    break;
                case YT.PlayerState.ENDED:
                    videoHasEnded = true;
                    pauseModal.style.display = 'none';
                    finishedModal.style.display = 'flex';
                    break;
                case YT.PlayerState.BUFFERING:
                    clearTimeout(pauseTimer);
                    break;
            }
        };

        const openVideoModal = (task) => {
            showingVideo.value = true;
            currentTaskUrl.value = '';
            
            const youtubeContainer = document.getElementById('youtube-container');
            const contentIframe = document.getElementById('content-iframe');
            
            youtubeContainer.style.display = 'block';
            contentIframe.style.display = 'none';
            
            if (!isYouTubeAPIReady) {
                const checkAPI = setInterval(() => {
                    if (typeof YT !== 'undefined' && YT.Player) {
                        isYouTubeAPIReady = true;
                        clearInterval(checkAPI);
                        createOrLoadVideo(task.videoId);
                    }
                }, 100);
            } else {
                createOrLoadVideo(task.videoId);
            }
        };

        const createOrLoadVideo = (videoId) => {
            if (!youtubePlayer) {
                initYouTubePlayer(videoId);
            } else {
                youtubePlayer.loadVideoById(videoId);
                videoHasEnded = false;
                if (shouldAutoplayVideo) {
                    youtubePlayer.playVideo();
                }
            }
            shouldAutoplayVideo = false;
        };
        
        
        // ==========================================
        // SECCIÓN 9: MODALES
        // ==========================================
        
        const openQuizModal = (task) => {
            const optionsHTML = task.options.map((option, index) => 
                `<button class="quiz-option" data-index="${index}">${option}</button>`
            ).join('');
            
            const content = `
                <h3>Quiz Rápido</h3>
                <p>${task.question}</p>
                <div class="quiz-options">${optionsHTML}</div>`;
                
            modal.content = content;
            modal.show = true;

            nextTick(() => {
                document.querySelectorAll('.quiz-option').forEach(button => {
                    button.onclick = (e) => {
                        const selectedIndex = parseInt(e.target.dataset.index);
                        if (selectedIndex === task.correctAnswer) {
                            closeModal();
                            completeCurrentTask();
                        } else {
                            e.target.style.backgroundColor = 'var(--danger-red)';
                            e.target.style.color = 'white';
                            speak("Respuesta incorrecta. Intenta de nuevo.");
                        }
                    };
                });
            });
        };

        const closeModal = () => {
            modal.show = false;
            modal.content = '';
        };
        
        
        // ==========================================
        // SECCIÓN 10: UTILIDADES (VOZ Y EFECTOS)
        // ==========================================
        
        const speak = (text, priority = 'normal') => {
            if ('speechSynthesis' in window) {
                if (priority === 'important') speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-MX';
                utterance.rate = 1.1;
                // speechSynthesis.speak(utterance); // Descomenta para activar
            }
        };

        const showConfetti = (count = 100) => {
            const colors = ['#6f42c1', '#48aee9', '#28a745', '#ffc107', '#dc3545'];
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = `${-10 - Math.random() * 10}vh`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.animationDuration = `${3 + Math.random() * 2}s`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5000);
            }
        };
        
        
        // ==========================================
        // SECCIÓN 11: LIFECYCLE HOOKS
        // ==========================================
        
        onMounted(() => {
            // Cargar datos del usuario
            fetchUserData();
            
            // Listener para mensajes entre frames
            window.addEventListener('message', (event) => {
                if (event.data === 'siguienteActividad') {
                    completeCurrentTask();
                }
            });
            
            // Configurar eventos del DOM
            nextTick(() => {
                // Parallax del banner
                const levelSelector = document.getElementById('levelSelector');
                const banner = document.querySelector('.banner-header');
                
                if (levelSelector && banner) {
                    levelSelector.addEventListener('scroll', function() {
                        let scrollTop = this.scrollTop;
                        let bannerHeight = banner.offsetHeight;
                        banner.style.transform = `translateY(-${scrollTop * 0.5}px)`;
                        let opacity = 1 - (scrollTop / bannerHeight);
                        banner.style.opacity = Math.max(0, opacity);
                    });
                }
                
                // Botón cerrar modal de pausa
                const closePauseButton = document.getElementById('closePauseButton');
                if (closePauseButton) {
                    closePauseButton.onclick = () => {
                        document.getElementById('pauseModal').style.display = 'none';
                        if (youtubePlayer) youtubePlayer.playVideo();
                    };
                }
                
                // Botón continuar después del video
                const continueVideoButton = document.getElementById('continueVideoButton');
                if (continueVideoButton) {
                    continueVideoButton.onclick = () => {
                        document.getElementById('finishedModal').style.display = 'none';
                        showingVideo.value = false;
                        document.getElementById('youtube-container').style.display = 'none';
                        document.getElementById('content-iframe').style.display = 'block';
                        videoHasEnded = false;
                        completeCurrentTask();
                    };
                }
            });
        });
        
        
        // ==========================================
        // SECCIÓN 12: RETURN (EXPONER AL TEMPLATE)
        // ==========================================
        
        return {
            // Estado
            currentView,
            isLoading,
            sidebarOpen,
            showingVideo,
            selectedLevel,
            lessons,
            pendingTasks,
            currentViewingTask,
            currentTaskUrl,
            progress,
            modal,
            levels,
            currentLevelIndex,
            currentLessonIndex,
            currentTaskIndex,
            viewingLessonIndex,
            viewingTaskIndex,
            totalTasksCompleted,
            totalTasks,
            
            // Funciones de navegación
            selectLevel,
            startApp,
            showLevelSelector,
            toggleSidebar,
            toggleLesson,

            prevTaskInfo,
            nextTaskInfo,
            handleNext,
            saveUserProgress,
            
            // Funciones de tareas
            viewTask,
            loadCurrentTask,
            completeCurrentTask,
            
            // Funciones de modales
            closeModal,
            
            // Utilidades
            getIconForTaskType
        };
    }
}).mount('#app');
</script> 
